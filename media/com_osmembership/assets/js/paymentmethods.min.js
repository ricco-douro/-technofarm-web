function PaymentMethod(e,t,a,n,o){this.name=e,this.creditCard=t,this.cardType=a,this.cardCvv=n,this.cardHolderName=o}function PaymentMethods(){this.length=0,this.methods=[]}function stripeTokenHandler(e){var t=document.getElementById("os_form"),a=document.createElement("input");a.setAttribute("type","hidden"),a.setAttribute("name","stripeToken"),a.setAttribute("value",e.id),t.appendChild(a),t.submit()}PaymentMethod.prototype.getName=function(){return this.name},PaymentMethod.prototype.getCreditCard=function(){return this.creditCard},PaymentMethod.prototype.getCardType=function(){return this.cardType},PaymentMethod.prototype.getCardCvv=function(){return this.cardCvv},PaymentMethod.prototype.getCardHolderName=function(){return this.cardHolderName},PaymentMethods.prototype.Add=function(e){this.methods[this.length]=e,this.length=this.length+1},PaymentMethods.prototype.Find=function(e){for(var t=0;t<this.length;t++)if(this.methods[t].name==e)return this.methods[t];return null},function(e){stripeResponseHandler=function(t,a){var n=e("#os_form");if(a.error)"card_error"==a.error.type&&"undefined"!=typeof osmStripeErrors&&osmStripeErrors[a.error.code]&&(a.error.message=osmStripeErrors[a.error.code]),alert(a.error.message),n.find("#btn-submit").prop("disabled",!1);else{var o=a.id;e("#x_card_num").val(""),e("#x_card_code").val(""),e("#card_holder_name").val(""),n.append(e('<input type="hidden" name="stripeToken" />').val(o)),n.get(0).submit()}},OSMVALIDATEFORM=function(t){e(t).validationEngine("attach",{onValidationComplete:function(e,t){return 1==t&&(e.on("submit",function(e){e.preventDefault()}),!0)}})},changePaymentMethod=function(){updatePaymentMethod(),1==document.os_form.show_payment_fee.value&&calculateSubscriptionFee()},updatePaymentMethod=function(){var t;document.os_form;t=e("input:radio[name^=payment_method]").length?e("input:radio[name^=payment_method]:checked").val():e("input[name^=payment_method]").val(),method=methods.Find(t),method&&(method.getCreditCard()?(e("#tr_card_number").show(),e("#tr_exp_date").show(),e("#tr_cvv_code").show(),method.getCardHolderName(),e("#tr_card_holder_name").show()):(e("#tr_card_number").hide(),e("#tr_exp_date").hide(),e("#tr_cvv_code").hide(),e("#tr_card_holder_name").hide()),"os_squareup"==t?e("#sq_field_zipcode").show():e("#sq_field_zipcode").hide(),"undefined"!=typeof stripe&&(0==t.indexOf("os_stripe")?e("#stripe-card-form").show():e("#stripe-card-form").hide()))},calculateSubscriptionFee=function(){var t,a=e("#btn-submit"),n=e("#ajax-loading-animation");void 0!==(t=e("input:radio[name^=payment_method]").length?e("input:radio[name^=payment_method]:checked").val():e("input[name^=payment_method]").val())&&(a.attr("disabled","disabled"),n.show(),e.ajax({type:"POST",url:siteUrl+"index.php?option=com_osmembership&task=register.calculate_subscription_fee&payment_method="+t+langLinkForAjax,data:e("#os_form input[name='plan_id'], #os_form input[name='coupon_code'], #os_form select[name='country'], #os_form select[name='state'], #os_form input.taxable[type='text'], #os_form input[name='coupon_code'], #os_form input[name='act'], #os_form input[name='renew_option_id'], #os_form input[name='upgrade_option_id'], #os_form .payment-calculation input[type='text'], #os_form .payment-calculation input[type='checkbox']:checked, #os_form .payment-calculation input[type='radio']:checked, #os_form .payment-calculation select"),dataType:"json",success:function(t,o,r){var i=e("#amount"),s=e("#payment-terms"),l=e("#trial_amount"),_=e("#vat_country_code");a.removeAttr("disabled"),n.hide(),e("#setup_fee").val(t.setup_fee),i.length&&(i.val(t.amount),e("#discount_amount").val(t.discount_amount),e("#tax_amount").val(t.tax_amount),e("#payment_processing_fee").val(t.payment_processing_fee),e("#gross_amount").val(t.gross_amount)),s.length&&(s.html(t.payment_terms),l.length&&(l.val(t.trial_amount),e("#trial_discount_amount").val(t.trial_discount_amount),t.trial_discount_amount>0?e("#trial_discount_amount_container").show():e("#trial_discount_amount_container").hide(),e("#trial_tax_amount").val(t.trial_tax_amount),t.trial_tax_amount>0?e("#trial_tax_amount_container").show():e("#trial_tax_amount_container").hide(),e("#trial_payment_processing_fee").val(t.trial_payment_processing_fee),t.trial_payment_processing_fee>0?e("#trial_payment_processing_fee_container").show():e("#trial_payment_processing_fee_container").hide(),e("#trial_gross_amount").val(t.trial_gross_amount),t.trial_discount_amount>0||t.trial_tax_amount>0||t.trial_payment_processing_fee>0?e("#trial_gross_amount_container").show():e("#trial_gross_amount_container").hide()),e("#regular_amount").val(t.regular_amount),e("#regular_discount_amount").val(t.regular_discount_amount),t.regular_discount_amount>0?e("#regular_discount_amount_container").show():e("#regular_discount_amount_container").hide(),e("#regular_tax_amount").val(t.regular_tax_amount),t.regular_tax_amount>0?e("#regular_tax_amount_container").show():e("#regular_tax_amount_container").hide(),e("#regular_payment_processing_fee").val(t.regular_payment_processing_fee),t.regular_payment_processing_fee>0?e("#regular_payment_processing_fee_container").show():e("#regular_payment_processing_fee_container").hide(),e("#regular_gross_amount").val(t.regular_gross_amount),t.regular_discount_amount>0||t.regular_tax_amount>0||t.regular_payment_processing_fee>0?e("#regular_gross_amount_container").show():e("#regular_gross_amount_container").hide()),_.length&&("GR"==t.country_code?_.text("EL"):_.text(t.country_code));var u=e("input[name^=vat_number_field]").val();u&&(1==t.show_vat_number_field?e("#field_"+u).show():e("#field_"+u).hide()),0==t.show_payment_information?e(".payment_information").css("display","none"):(e(".payment_information").css("display",""),updatePaymentMethod()),1==t.coupon_valid?e("#coupon_validate_msg").hide():e("#coupon_validate_msg").show(),1==t.vatnumber_valid?e("#vatnumber_validate_msg").hide():e("#vatnumber_validate_msg").show()},error:function(e,t,a){alert(t)}}))},showHideDependFields=function(t,a,n){var o=e("#btn-submit"),r=e("#ajax-loading-animation");o.attr("disabled","disabled"),o.show(),e.ajax({type:"POST",url:siteUrl+"index.php?option=com_osmembership&task=register.get_depend_fields_status&field_id="+t+langLinkForAjax,data:e(".master-field input[type='checkbox']:checked, .master-field input[type='radio']:checked, .master-field select"),dataType:"json",success:function(t,a,n){o.removeAttr("disabled"),r.hide();var i,s=t.hide_fields.split(","),l=t.show_fields.split(",");for(i=0;i<s.length;i++)e("#"+s[i]).hide();for(i=0;i<l.length;i++)e("#"+l[i]).show();calculateSubscriptionFee()},error:function(e,t,a){alert(t)}})},buildStateField=function(t,a,n){if(e("#"+t).length&&e("#"+t).is("select")){if(e("#"+a).length)var o=e("#"+a).val();else o="";e.ajax({type:"GET",url:siteUrl+"index.php?option=com_osmembership&task=register.get_states&country_name="+o+"&field_name="+t+"&state_name="+n+langLinkForAjax,success:function(n){e("#field_"+t+" .controls").length?e("#field_"+t+" .controls").html(n):e("#field_"+t+" .col-md-9").length?e("#field_"+t+" .col-md-9").html(n):e("#field_"+t+" .uk-form-controls").html(n),"undefined"!=typeof taxStateCountries&&"state"==t&&taxStateCountries[0]&&e("#state").change(function(){if(e("#"+a).length)var t=e("#country").val();else t=e("#default_country").val();t&&-1!=e.inArray(t,taxStateCountries)&&calculateSubscriptionFee()})},error:function(e,t,a){alert(t)}}),e("#"+a).length&&e("#"+a).change(function(){e.ajax({type:"GET",url:siteUrl+"index.php?option=com_osmembership&task=register.get_states&country_name="+e(this).val()+"&field_name="+t+"&state_name="+n+langLinkForAjax,success:function(a){e("#field_"+t+" .controls").length?e("#field_"+t+" .controls").html(a):e("#field_"+t+" .col-md-9").length?e("#field_"+t+" .col-md-9").html(a):e("#field_"+t+" .uk-form-controls").html(a),"undefined"!=typeof taxStateCountries&&"state"==t&&taxStateCountries[0]&&e("#state").change(function(){if(e("#country").length)var t=e("#country").val();else t="";t&&-1!=e.inArray(t,taxStateCountries)&&calculateSubscriptionFee()})},error:function(e,t,a){alert(t)}}),0!=(paymentMethod=e("input[name^=country_base_tax]").val())&&calculateSubscriptionFee()})}else e("#"+a).length&&e("#"+a).change(function(){0!=(paymentMethod=e("input[name^=country_base_tax]").val())&&calculateSubscriptionFee()})},buildStateFields=function(t,a,n){var o=e("#"+a),r=e("#"+t);r.length&&r.is("select")?o.length&&o.change(function(){e.ajax({type:"GET",url:siteUrl+"index.php?option=com_osmembership&task=register.get_states&country_name="+e(this).val()+"&field_name="+t+"&state_name="+n+langLinkForAjax,success:function(a){e("#field_"+t+" .controls").length?e("#field_"+t+" .controls").html(a):e("#field_"+t+" .col-md-9").length?e("#field_"+t+" .col-md-9").html(a):e("#field_"+t+" .uk-form-controls").html(a),"undefined"!=typeof taxStateCountries&&"state"==t&&taxStateCountries[0]&&e("#state").change(function(){var t;(t=e("#country").length?e("#country").val():"")&&-1!=e.inArray(t,taxStateCountries)&&calculateSubscriptionFee()})},error:function(e,t,a){alert(t)}}),0!=(paymentMethod=e("input[name^=country_base_tax]").val())&&calculateSubscriptionFee()}):o.length&&o.change(function(){0!=e("input[name^=country_base_tax]").val()&&calculateSubscriptionFee()})}}(OSM.jQuery);