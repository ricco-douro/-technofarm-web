jQuery.jchat=jchatAlias;function jchatAlias($){var jsonLiveSite=jchat_livesite+"index.php?option=com_jchat&format=json";var htmlLiveSite=jchat_livesite+"index.php?option=com_jchat&format=raw";var t={};var s={};var T="";var r=0;var o=0;var J=true;var U;var X=2000;var K=2000;var F=10000;var emptyResponse=20;var restartInterval=1;var h=1;var R=0;var n=0;var l=1;var vars=null;var targetElement="body";var chatTitle="";var forceBuddylistRefresh=0;var wallMessagesAlertInterval=null;var audio=1;var sound=false;var avatarUploadEnabled=true;var avatarEnabled=true;var attachmentsEnabled=true;var tabLength=14;var headLength=30;var chatLength=20;var buddyLength=18;var chatRoomLength=32;var buddyList={};var publicChatStateClosed=false;var firstCall=true;var popupPositions=new Object();var popupDimensions=new Object();var asyncSendMessage="before";var popupState=new Object();var defaultPopupHeight=211;var wallStartHeight=0;var isContentEditable=null;var longname=null;var shortname=null;var my_username;var my_avatar;var fromPlaceholder;var writeElement='<div contentEditable="true" class="jchat_textarea"></div>';var writeElementWall='<div contentEditable="true" class="jchat_textarea jchat_textarea_wall"></div>';var valFunction="html";var guestEnabledMode=0;var usersBanning=0;var timeoutID=null;var isTabFocused=true;var originalPageTitle=$("title").text();var excludeOnMobile=false;var wordsBanning=false;var wordsBanned="shit,fuck,cock,asshole";var wordsBannedReplacement="banned";var currentJoinedChatRoom=null;var roomsAvailable=new Array();var myChatRoomUsers=new Array();var showChatroomsUsersDetails=true;var chatRoomLatestMessages=true;var autoClearConversation=true;var skypeEnabled=true;var groupChat=1;var buddyListVisible=true;var groupChatMode="chatroom";var chatboxesOpenMode=false;var resizableChatboxes=true;var resizableSidebar=true;var searchFieldEnabled=true;var messagesHistory=true;var renderingMode="auto";var privateChatEnabled=true;var typingEnabled=true;var maximizeButton=1024;var autoClosePopups=true;var debugEnabled=false;var isGuest=true;var allowGuestAvatarupload=true;var allowGuestFileupload=true;var allowGuestSkypeBridge=true;var allowGuestOverrideName=true;var allowGuestBanning=true;var allowMediaObjects=true;$("<div/>").attr("id","jchat_base").appendTo($(jchatTargetElement));function injectFloatingMsg(text,userDetails){if(userDetails){text=sprintf(text,userDetails)}$("div#jchat_msg").remove();$("<div/>").attr("id","jchat_msg").prependTo("body").css("height","10px").append('<div id="jchat_msgtext">'+text+"</div>").css("margin-top",0).animate({height:"50px","margin-top":"-25px"},500,"linear").delay(2500).fadeOut(500,function(){$(this).remove()})}function triggerGenericPopover(selector,element,text){var leftKonstant=0;var topKonstant=0;if(!text){text=$(element).data("text")}if(!text){return}if(selector.match(/jchat_room/i)){leftKonstant=25;text=text.replace(/\r?\n/ig,"<br/>")}var maximizedClass="";var parentPopupContainer=$(element).parents(".jchat_tabpopup.jchat_tabopen");if($(parentPopupContainer).hasClass("maximized")&&!selector.match(/jchat_contact/i)){maximizedClass=" maximized"}$(selector).remove();$("body").append('<div id="'+selector.replace("#","")+'" class="jchat_generic_tooltip'+maximizedClass+'"><div class="jchat_tooltip_content">'+text+"</div></div>");var ab=$(element).offset();var Y=$(element).width();var elementWidth=$(selector).width();if(maximizedClass){elementWidth=24;if(selector.match(/jchat_skype/i)){leftKonstant=175;topKonstant=-75}}$(selector).css("left",(ab.left+Y)-$(window).scrollLeft()-elementWidth-leftKonstant+8).css("display","block");$(selector).css("top",(ab.top-parseInt($(selector).height())-topKonstant-6)-$(window).scrollTop()+"px")}function bindHistoryTooltipEvents(identifier,completeObject){$(".jchat_trigger_history","#jchat_user_"+identifier+"_popup").toggle(function(event){if(!!$('.jchat_tabcontent div[class$="tooltip"]',"#jchat_user_"+identifier+"_popup").length){$('.jchat_tabcontent div[class$="tooltip"]',"#jchat_user_"+identifier+"_popup").next().trigger("click")}historyTooltip(this,"#jchat_user_"+identifier+"_popup",identifier,completeObject.loggedid);$(this).addClass("toggle_on")},function(event){$(".jchat_historytooltip","#jchat_user_"+identifier+"_popup").remove();$(this).removeClass("toggle_on")})}function wallTooltipUsers(element){var concatenatedUsers=null;switch(groupChatMode){case"global":concatenatedUsers=jchat_groupchat_allusers;break;case"chatroom":concatenatedUsers=jchat_groupchat_nousers;if(myChatRoomUsers.length||currentJoinedChatRoom){concatenatedUsers=my_username+", ";for(var i=0;i<myChatRoomUsers.length;i++){concatenatedUsers+=myChatRoomUsers[i]+", ";if(((i+1)%3)==0&&(i+1)<myChatRoomUsers.length){concatenatedUsers+="<br/>"}}concatenatedUsers=concatenatedUsers.slice(0,-2)}else{concatenatedUsers=my_username+", ";if(!$.isEmptyObject(buddyList)){var counter=0;$.each(buddyList,function(index,user){if(!user.hasroomid){concatenatedUsers+=user.name+", ";if(((counter+1)%3)==0){concatenatedUsers+="<br/>"}counter++}})}concatenatedUsers=concatenatedUsers.replace(/<br\/>$/gi,"");concatenatedUsers=concatenatedUsers.slice(0,-2)}break;case"invite":var usersOfGroupChat=$("div[id^=jchat_userlist] span.jchat_contact[data-contact=1]");if(usersOfGroupChat.length){concatenatedUsers=my_username+"<br/>";for(var i=0;i<usersOfGroupChat.length;i++){concatenatedUsers+=$(usersOfGroupChat[i]).attr("data-name")+"<br/>"}}else{concatenatedUsers=jchat_groupchat_nousers}break}var maximizedClass="";var parentPopupContainer=$(element).parents(".jchat_tabpopup.jchat_tabopen");if($(parentPopupContainer).hasClass("maximized")){maximizedClass=" maximized"}$("#jchat_users_informations_tooltip").remove();$("body").append('<div id="jchat_users_informations_tooltip" class="jchat_generic_tooltip'+maximizedClass+'"><div class="jchat_tooltip_content">'+concatenatedUsers+"</div></div>");var ab=$(element).offset();var Y=$(element).width();var elementWidth=$("#jchat_users_informations_tooltip").width();if(maximizedClass){elementWidth=24}$("#jchat_users_informations_tooltip").css("left",(ab.left+Y)-$(window).scrollLeft()-elementWidth+12).css("display","block");$("#jchat_users_informations_tooltip").css("top",(ab.top-parseInt($("#jchat_users_informations_tooltip").height())-5)-$(window).scrollTop()+"px")}function hoverSidebarTooltips(element,text){if($("#jchat_tooltip").length>0){$("#jchat_tooltip .jchat_tooltip_content").html(text)}else{$(jchatTargetElement).append('<div id="jchat_tooltip"><div class="jchat_tooltip_content">'+text+"</div></div>")}var ab=$(element).offset();var Y=$(element).width();var mixed=$("#jchat_tooltip").width();$("#jchat_tooltip").css({top:ab.top-28-$(window).scrollTop(),left:(ab.left+Y)-$(window).scrollLeft()-mixed+12,display:"block"});if(avatarUploadEnabled!==true||(isGuest&&!allowGuestAvatarupload)){$("#jchat_avatar").remove()}if(!skypeEnabled||(isGuest&&!allowGuestSkypeBridge)){$("div.jchat_skype").next().remove().end().remove()}if(!isGuest||!allowGuestOverrideName){$("div.jchat_override_name").next().remove().end().remove()}}function avatarTooltip(element,userName,messageTime){var selfMessageClass="";var parentImgContainer=$(element).parents("div.jchat_chatboxmessage");if(!parentImgContainer.hasClass("selfmessage")){selfMessageClass="selfmessage"}$(element).parent().append('<div id="jchat_avatartooltip" class="'+selfMessageClass+'"><div class="jchat_tooltip_content"></div></div>');var formattedTime="";if(messageTime!==undefined){formattedTime='<br/><span class="jchat_time_details">'+messageTime+"</span>"}$("#jchat_avatartooltip .jchat_tooltip_content").html(userName+formattedTime);var ab=$(element).offset();var Y=$(element).width();var windowScroll=jchatGetPageScroll();var tooltipWidth=$("#jchat_avatartooltip").width();if(selfMessageClass){tooltipWidth=-35}$("#jchat_avatartooltip").css("top",ab.top-parseInt(windowScroll[1])).css("left",(ab.left+Y)-$(window).scrollLeft()-tooltipWidth-35).css("display","block").css("z-index",10002)}function avatarUploadTooltip(element){$(element).before('<div class="jchat_avatar_upload_tooltip"></div>');$(".jchat_avatar_upload_tooltip").append('<div class="jchat_tooltip_header jchat_tooltip_avatar_upload_header">'+jchat_manage_avatars+"</div>");$(".jchat_avatar_upload_tooltip").click(function(){$(element).trigger("click")});$(".jchat_avatar_upload_tooltip").append("<img/>").children("img").attr("src",jchat_livesite+"components/com_jchat/images/loading.gif").css({position:"absolute",margin:"25% 38%",width:"64px"});$(".jchat_avatar_upload_tooltip").append('<iframe id="avatarUpload_iframe" scrolling="no" src="'+htmlLiveSite+'&task=avatar.display"></iframe>');$("#avatarUpload_iframe").load(function(){setTimeout(function(){$(".jchat_avatar_upload_tooltip img").remove()},1)});var ab=$(element).offset();var Y=$(element).width();var windowScroll=jchatGetPageScroll();var mixed=($(".jchat_avatar_upload_tooltip").width()-$(element).width())/2;$(".jchat_avatar_upload_tooltip").css("top",ab.top-parseInt(windowScroll[1])-150).css("left",ab.left-$(window).scrollLeft()-mixed+14).css("display","block").css("z-index",10002)}function emoticonsTooltip(element,context,identifier,wall){var dataWall="";var dataUserID="";if(wall){dataWall=' data-wall="1" '}else{dataUserID=' data-userid="'+identifier+'" '}var maximized=false;var parentPopupContainer=$(element).parents(".jchat_tabpopup.jchat_tabopen");if($(parentPopupContainer).hasClass("maximized")){maximized=true}$(element).before("<div"+dataUserID+dataWall+' class="jchat_emoticonstooltip"></div>');var emoticonsIcons=new Array();var indexCounter=0;$.each(jQuery.jchat_emoticons,function(index,value){if((index>0)&&(index%10)==0){indexCounter++}if(emoticonsIcons[indexCounter]===undefined){emoticonsIcons[indexCounter]=""}emoticonsIcons[indexCounter]+='<img class="jchat_emoticons" title="'+value.title+'" src="'+value.path+'"/>'});$(".jchat_tooltip_header",context).click(function(){$(element).trigger("click")});$.each(emoticonsIcons,function(k,elements){$(".jchat_emoticonstooltip",context).append('<div class="jchat_tooltip_content">'+elements+"</div>")});var ab=$(element).offset();var triggerWidth=$(element).innerWidth();var windowScroll=jchatGetPageScroll();var elementWidth=216;if(maximized){elementWidth=triggerWidth}$(".jchat_emoticonstooltip",context).css("top",ab.top-parseInt(windowScroll[1])-132).css("left",ab.left-$(window).scrollLeft()-elementWidth+triggerWidth).css("display","block").css("z-index",10002);$(".jchat_emoticonstooltip img",context).click(function(event){var range,selection;var targetContentEditable=$(this).parent().parent().prev().children("div");var nativeElement=$(targetContentEditable).get(0);if($.support.leadingWhitespace&&isContentEditable){var clonedEmoticon=$(this).clone();$("br:last-child",targetContentEditable).remove();$(targetContentEditable).append(clonedEmoticon)}else{if(isContentEditable){var fromTitle=" "+$(this).attr("title");$(targetContentEditable).append(fromTitle)}else{var fromTitle=" "+$(this).attr("title");targetContentEditable=$(this).parent().parent().prev().children("textarea");$(targetContentEditable).val($(targetContentEditable).val()+fromTitle)}}if(document.createRange){range=document.createRange();range.selectNodeContents(nativeElement);range.collapse(false);selection=window.getSelection();selection.removeAllRanges();if(!jchatHasTouch()){selection.addRange(range)}}else{if(document.selection){range=document.body.createTextRange();range.moveToElementText(nativeElement);range.collapse(false);if(!jchatHasTouch()){range.select()}}}if(!jchatHasTouch()){targetContentEditable.focus()}if(jchatHasTouch()||autoClosePopups){$(element).trigger("click")}});if(!jchatHasTouch()){$("div.jchat_textarea").focus()}}function addChatRoomsUsersDetails(room,isMyJoinedRoom){var maxOtherUsersPerLine=3;if(renderingMode=="module"){maxOtherUsersPerLine=2}if(showChatroomsUsersDetails){var targetRoomName=$("div [data-roomcountid="+room.id+"]");var concatenatedUsersInThisRoom="";if(isMyJoinedRoom){concatenatedUsersInThisRoom+=my_username+", "}if(room.users){$.each(room.users,function(index,user){concatenatedUsersInThisRoom+=user+", ";if(((index+1)%maxOtherUsersPerLine)==0&&(index+1)<room.users.length){concatenatedUsersInThisRoom+="<br/>"}})}targetRoomName.data("text",concatenatedUsersInThisRoom.slice(0,-2))}}function roomsTooltip(element,context,wall){$(element).before('<div id="jchat_roomstooltip" class="jchat_roomstooltip"><span id="jchat_roomsdragger" class="jchat_tab">'+jchat_available_rooms+'</span><div class="jchat_roomslist"></div></div>');$("#jchat_roomstooltip span.jchat_tab").append('<div class="jchat_closebox_bottom"></div>');$("#jchat_roomstooltip span.jchat_tab .jchat_closebox_bottom").on("click",function(){$(".jchat_trigger_room","#jchat_wall_popup").trigger("click")});if(jchatHasTouch()){$("#jchat_roomstooltip span.jchat_tab").css("background-position","97% -851px")}if(!$.isArray(roomsAvailable)){$.each(roomsAvailable,function(k,room){var isMyJoinedRoom=!!(room.id==currentJoinedChatRoom);var roomStructure=$("<div/>").attr("class","jchat_room");room.name=room.name.length<chatRoomLength?room.name:room.name.substr(0,chatRoomLength)+"...";roomStructure.html('<div class="jchat_roomleft"><div class="jchat_roomname" data-text="'+room.description+'">'+room.name+'</div><div class="jchat_roomcount" data-roomcountid="'+room.id+'">'+jchat_chatroom_users+room.numusers+'</div></div><div class="jchat_roomright"><div class="jchat_roomjoin" data-roomid="'+room.id+'" data-name="'+room.name+'">'+jchat_chatroom_join+"</div></div>");$(".jchat_roomslist",context).append(roomStructure);if(isMyJoinedRoom){$("div[data-roomid="+currentJoinedChatRoom+"]").addClass("jchat_joined").data("joined",true).text(jchat_chatroom_joined)}addChatRoomsUsersDetails(room,isMyJoinedRoom)});$("div.jchat_roomjoin").on("click",chatRoomsJoiner)}else{var roomStructure=$("<div/>").attr("class","jchat_room");roomStructure.html('<div class="jchat_roomname">'+jchat_noavailable_rooms+"</div>");$(".jchat_roomslist",context).append(roomStructure)}var maximized=false;var parentPopupContainer=$(element).parents(".jchat_tabpopup.jchat_tabopen");if($(parentPopupContainer).hasClass("maximized")){maximized=true}var ab=$(element).offset();var triggerWidth=$(element).innerWidth();var windowScroll=jchatGetPageScroll();var elementWidth=$(".jchat_roomstooltip",context).width()+2;if(maximized){elementWidth=triggerWidth}$(".jchat_roomstooltip",context).css("top",ab.top-parseInt(windowScroll[1])-232).css("left",ab.left-$(window).scrollLeft()-elementWidth+triggerWidth).css("display","block").css("z-index",10002);$("#jchat_roomstooltip").draggable({handle:"#jchat_roomsdragger",start:function(event,ui){$(this).addClass("dragging")},stop:function(event,ui){$(this).removeClass("dragging")}});jchatInitTouchEvents($("#jchat_roomsdragger").get(0))}function chatRoomsJoiner(event){var joinedRoomId=$(this).data("roomid");var currentState=$(this).data("joined");if(!currentState){$(".jchat_roomjoin").removeClass("jchat_joined").data("joined",false).text(jchat_chatroom_join);$(".jchat_userstabtitle","#jchat_wall_popup").next(".jchat_userstabsubtitle").remove();$(this).addClass("jchat_joined").data("joined",true);$(this).text(jchat_chatroom_joined);var chatRoomName=$(this).data("name");currentJoinedChatRoom=joinedRoomId;var subTitle=$("<div/>").addClass("jchat_userstabsubtitle").html('<span class="jchat_roomtitle">'+jchat_chatroom+"</span> "+chatRoomName);$(".jchat_userstabtitle","#jchat_wall_popup").after(subTitle);$("#jchat_wall_popup .jchat_userstabsubtitle").width($("#jchat_wall_popup").width()-7)}else{$(this).removeClass("jchat_joined").data("joined",false);$(this).text(jchat_chatroom_join);$(".jchat_userstabtitle","#jchat_wall_popup").next(".jchat_userstabsubtitle").remove();currentJoinedChatRoom=null;joinedRoomId=null}if(autoClearConversation){$("div.jchat_chatboxmessage","#jchat_wall_popup").remove()}if(jchatHasTouch()||autoClosePopups){setTimeout(function(){$(".jchat_trigger_room","#jchat_wall_popup").trigger("click")},500)}$.post(jsonLiveSite,{roomid:joinedRoomId,task:"stream.saveEntity"},function(response){if(joinedRoomId&&chatRoomLatestMessages){restartUpdateSession("buddylist","1")}if(!response.storing.status){showDebugMsgs(response.storing.details)}})}function uploadFileTooltip(element,context,to,tologged){var maximized=false;var parentPopupContainer=$(element).parents(".jchat_tabpopup.jchat_tabopen");if($(parentPopupContainer).hasClass("maximized")){maximized=true}$(element).before('<div data-userid="'+to+'" class="jchat_fileuploadtooltip"></div>');$(".jchat_fileuploadtooltip",context).append("<img/>").children("img").attr("src",jchat_livesite+"components/com_jchat/images/loading.gif").css({position:"absolute",margin:"10px 46%",width:"32px"});$(".jchat_fileuploadtooltip",context).append('<iframe id="fileupload_iframe"  scrolling="no" src="'+htmlLiveSite+"&task=attachments.display&to="+to+"&tologged="+tologged+'"></iframe>');$("#fileupload_iframe",context).load(function(){setTimeout(function(){$(".jchat_fileuploadtooltip img",context).remove()},1)});var ab=$(element).offset();var triggerWidth=$(element).innerWidth();var windowScroll=jchatGetPageScroll();var elementWidth=$(".jchat_fileuploadtooltip",context).width()+2;if(maximized){elementWidth=triggerWidth}$(".jchat_fileuploadtooltip",context).css("top",ab.top-parseInt(windowScroll[1])-59).css("left",ab.left-$(window).scrollLeft()-elementWidth+triggerWidth).css("display","block").css("z-index",10002);if(!jchatHasTouch()){$("div.jchat_textarea").focus()}}function infoGuestTooltip(element,context,identifier){$(element).before('<div data-userid="'+identifier+'" class="jchat_infoguesttooltip"></div>');var infoCache=new Array();$.ajax({url:jsonLiveSite,data:{guestsession:identifier,task:"stream.showEntity"},type:"get",cache:false,dataType:"json",success:function(response){if(response.status){$.each(response.details,function(title,info){title=title.charAt(0).toUpperCase()+title.slice(1)+":";info=info?info:"-",$(".jchat_infoguesttooltip").append('<div class="jchat_infoguest_title">'+title+"</div>");$(".jchat_infoguesttooltip").append('<div class="jchat_infoguest_value">'+info+"</div>")})}else{showDebugMsgs(response.details);return false}}});var maximized=false;var parentPopupContainer=$(element).parents(".jchat_tabpopup.jchat_tabopen");if($(parentPopupContainer).hasClass("maximized")){maximized=true}var ab=$(element).offset();var triggerWidth=$(element).innerWidth();var windowScroll=jchatGetPageScroll();var elementWidth=$(".jchat_infoguesttooltip",context).width()+2;if(maximized){elementWidth=triggerWidth}$(".jchat_infoguesttooltip",context).css("top",ab.top-parseInt(windowScroll[1])-201).css("left",ab.left-$(window).scrollLeft()-elementWidth+triggerWidth).css("display","block").css("z-index",10002)}function historyTooltip(element,context,identifier,logged_identifier){$(element).before('<div data-userid="'+identifier+'" data-loggedid="'+logged_identifier+'" class="jchat_historytooltip"></div>');var periodsAvailable=new Array("1d","1w","1m","3m","6m","1y");$(".jchat_historytooltip","#jchat_user_"+identifier+"_popup").append('<div id="jchat_select_period">'+jchat_select_period+"</div>");$.each(periodsAvailable,function(index,period){$(".jchat_historytooltip","#jchat_user_"+identifier+"_popup").append('<div data-value="'+period+'" class="jchat_single_period">'+eval("jchat_period_"+period)+"</div>")});$("div.jchat_single_period").on("click",function(jqEvent){var loggedID=$(this).parent().data("loggedid");var period=$(this).data("value");var minMessageID=null;var messagesParent=$(this).parents("div.jchat_tabcontent.messagelist");var minMessageElementId=messagesParent.find("div.jchat_tabcontenttext.private div.jchat_chatboxmessage:first-child").attr("id");if(minMessageElementId){minMessageID=minMessageElementId.split("_")[2]}var conversationSessionUserId=$(this).parent().data("userid");fetchHistoryMessages(loggedID,conversationSessionUserId,period,minMessageID);if(jchatHasTouch()||autoClosePopups){$(element).trigger("click")}});var ab=$(element).offset();var Y=$(element).width();var windowScroll=jchatGetPageScroll();var mixed=$(".jchat_historytooltip",context).width();$(".jchat_historytooltip",context).css("top",ab.top-parseInt(windowScroll[1])-161).css("left",ab.left-$(window).scrollLeft()-mixed+18).css("display","block").css("z-index",10002)}function sendMessage(Z,Y,userid,loggedid){if(Z.keyCode==13&&Z.shiftKey==0){var message=eval("$(Y)."+valFunction+"()");message=message.replace(/^\s+|\s+$/g,"");message=html_entity_decode(message,"ENT_QUOTE");message=message.replace(/<a\b[^>]*>|<\/a>/gi,"");var linksArray=message.match(/([^">=]http|[^">]https|^http|^https):\/\/(\w+:{0,1}\w*@)?(\S+)(:[0-9]+)?(\/|\/([\w#!:.?+=&%@!\-\/]))?/gi);if(linksArray!==null&&linksArray.length>0){$.each(linksArray,function(index,link){message=message.replace(link,'<a target="_blank" href="'+link.trim()+'">'+link+"</a>")})}message=strip_tags(message,allowMediaObjects,true);message=$.jchatEmoticons(message);if(wordsBanning&&wordsBanned){message=message.replace(new RegExp(wordsBanned.split(",").join("|"),"g"),"*"+wordsBannedReplacement+"*")}eval("$(Y)."+valFunction+'("")');$(Y).css("height","21px");var thisPopupHeight=popupDimensions[userid]?popupDimensions[userid].height+11:defaultPopupHeight;if(resizableChatboxes&&!jchatHasTouch()){$("#jchat_user_"+userid+"_popup").resizable("enable")}$("#jchat_user_"+userid+"_popup .jchat_tabcontenttext").css("height",parseInt(thisPopupHeight-11)+"px");$(Y).css("overflow-y","hidden");if(!jchatHasTouch()){$(Y).focus()}else{$(Y).blur();$("body").focus()}$("span.msg_seen","#jchat_user_"+userid+"_popup").remove();if(message!=""&&message!="<br>"){if(asyncSendMessage=="before"){$(".jchat_chatboxmessage.dummy_typing","#jchat_user_"+userid+"_popup").remove();$("#jchat_userlist_"+userid).trigger("addmessage",[message,"1","1","temp",{time:""}]);$("#jchat_user_"+userid+"_popup .jchat_tabcontenttext").scrollTop($("#jchat_user_"+userid+"_popup .jchat_tabcontenttext")[0].scrollHeight)}$.post(jsonLiveSite,{to:userid,tologged:loggedid,message:message,task:"stream.saveEntity"},function(response){if(response.storing.status){$(".jchat_chatboxmessage.dummy_typing","#jchat_user_"+userid+"_popup").remove();$("#jchat_message_temp","#jchat_user_"+userid+"_popup").remove();var idmessaggio=response.storing.details.id;var insertionTime=response.storing.details.time;if(idmessaggio){$("#jchat_userlist_"+userid).trigger("addmessage",[message,"1","1",idmessaggio,{time:insertionTime}]);$("#jchat_user_"+userid+"_popup .jchat_tabcontenttext").scrollTop($("#jchat_user_"+userid+"_popup .jchat_tabcontenttext")[0].scrollHeight)}}else{showDebugMsgs(response.storing.details);return false}h=1;if(K>X){K=X;clearTimeout(U);U=setTimeout(function(){ajaxReceive()},X)}});if(typingEnabled&&timeoutID){clearTimeout(timeoutID);timeoutID=null;s.typing=0;s.typing_to=null;b("updatesession","1")}}return false}else{if(typingEnabled){s.typing=1;s.typing_to=userid;b("updatesession","1");if(timeoutID){clearTimeout(timeoutID)}timeoutID=setTimeout(function(){clearTimeout(timeoutID);timeoutID=null;s.typing=0;s.typing_to=null;b("updatesession","1")},K/2)}}}function sendWallMessage(Z,Y){if(Z.keyCode==13&&Z.shiftKey==0){var message=eval("$(Y)."+valFunction+"()");message=message.replace(/^\s+|\s+$/g,"");message=html_entity_decode(message,"ENT_QUOTE");message=message.replace(/<a\b[^>]*>|<\/a>/gi,"");var linksArray=message.match(/([^">=]http|[^">]https|^http|^https):\/\/(\w+:{0,1}\w*@)?(\S+)(:[0-9]+)?(\/|\/([\w#!:.?+=&%@!\-\/]))?/gi);if(linksArray!==null&&linksArray.length>0){$.each(linksArray,function(index,link){message=message.replace(link,'<a target="_blank" href="'+link.trim()+'">'+link+"</a>")})}message=strip_tags(message,allowMediaObjects,true);message=$.jchatEmoticons(message);if(wordsBanning&&wordsBanned){message=message.replace(new RegExp(wordsBanned.split(",").join("|"),"g"),"*"+wordsBannedReplacement+"*")}var testomessaggio=message.replace(/&/gi,"&amp;");eval("$(Y)."+valFunction+'("")');$(Y).css("height","21px");$(Y).css("overflow-y","hidden");if(!jchatHasTouch()){$(Y).focus()}else{$(Y).blur();$("body").focus()}popupsReposition();if(message!=""&&message!="<br>"){if(asyncSendMessage=="before"){if(my_avatar!==undefined&&my_avatar!==null&&my_avatar!==""&&avatarEnabled===true){var tempPlaceholder='<img width="32px" height="32px" src="'+my_avatar+'" />'}else{var tempPlaceholder="<strong>"+my_username+"</strong>"}$("#jchat_wall_popup div.jchat_tabcontenttext").append('<div class="jchat_chatboxmessage selfmessage" id="jchat_message_publictemp"><span class="jchat_chatboxmessagefrom">'+tempPlaceholder+'</span><span class="jchat_chatboxmessagecontent selfmessage">'+testomessaggio+"</span></div>")}$.post(jsonLiveSite,{to:"wall",message:message,task:"stream.saveEntity"},function(response){if(response.storing.status){$("#jchat_message_publictemp","#jchat_wall_popup").remove();var idmessaggio=response.storing.details.id;var insertionTime=response.storing.details.time;if(idmessaggio){if(my_avatar!==undefined&&my_avatar!==null&&my_avatar!==""&&avatarEnabled===true){fromPlaceholder='<img alt="'+jchat_you+my_username+'" data-time="'+insertionTime+'" width="32px" height="32px" src="'+my_avatar+'" />'}else{fromPlaceholder="<strong>"+my_username+"</strong>"}if($("#jchat_message_"+idmessaggio).length>0){}else{$("#jchat_wall_popup div.jchat_tabcontenttext").append('<div class="jchat_chatboxmessage selfmessage" id="jchat_message_'+idmessaggio+'"><span class="jchat_chatboxmessagefrom">'+fromPlaceholder+'</span><span class="jchat_chatboxmessagecontent selfmessage">'+testomessaggio+"</span></div>");$("span.jchat_chatboxmessagefrom img","#jchat_wall_popup").mouseover(function(event){avatarTooltip(this,$(this).attr("alt"),$(this).data("time"))}).mouseout(function(event){$("#jchat_avatartooltip").remove()})}$("#jchat_wall_popup div.jchat_tabcontenttext").scrollTop($("#jchat_wall_popup div.jchat_tabcontenttext")[0].scrollHeight)}}else{showDebugMsgs(response.storing.details);return false}h=1;if(K>X){K=X;clearTimeout(U);U=setTimeout(function(){ajaxReceive()},X)}})}return false}}function deleteConversation(conversationFromId,isWall){$.post(jsonLiveSite,{from:conversationFromId,task:"stream.saveEntity"},function(response){if(!isWall){$("div.jchat_chatboxmessage, span.msg_seen","#jchat_user_"+conversationFromId+"_popup").remove()}else{$("div.jchat_chatboxmessage","#jchat_wall_popup").remove()}if(!response.storing.status){showDebugMsgs(response.storing.details)}})}function popup(ab,mixed,ac){var Z=mixed.clientHeight;var Y=94;if(Y>Z){Z=Math.max(mixed.scrollHeight,Z);if(Y){Z=Math.min(Y,Z)}if(Z>mixed.clientHeight){$(mixed).css("height",Z+4+"px");var thisPopupHeight=popupDimensions[ac]?popupDimensions[ac].height+11:defaultPopupHeight;$("#jchat_user_"+ac+"_popup .jchat_tabcontenttext").css("height",parseInt(thisPopupHeight-Z+6)+"px");if(resizableChatboxes&&!jchatHasTouch()){$("#jchat_user_"+ac+"_popup").resizable("disable")}}}else{$(mixed).css("overflow-y","auto")}$("#jchat_user_"+ac+"_popup .jchat_tabcontenttext").scrollTop($("#jchat_user_"+ac+"_popup .jchat_tabcontenttext")[0].scrollHeight)}function popupWall(ab,mixed,wallStartHeight){var Z=mixed.clientHeight;var Y=94;if(Y>Z){Z=Math.max(mixed.scrollHeight,Z);if(Y){Z=Math.min(Y,Z)}if(Z>mixed.clientHeight){$(mixed).css("height",Z+4+"px");$("#jchat_wall_popup div.jchat_tabcontenttext").height(wallStartHeight-($(".jchat_textarea_wall").height()-21))}}else{$(mixed).css("overflow-y","auto")}$("#jchat_wall_popup div.jchat_tabcontenttext").scrollTop($("#jchat_wall_popup div.jchat_tabcontenttext")[0].scrollHeight)}function statusClassOp(){$("#jchat_optionsbutton_popup .offline").css("text-decoration","none");$("#jchat_optionsbutton_popup .available").css("text-decoration","none");$("#jchat_userstab_icon").removeClass("jchat_user_available2");$("#jchat_userstab_icon").removeClass("jchat_user_offline")}function postStatus(Y){$.post(jsonLiveSite,{status:Y,task:"stream.saveEntity"},function(response){if(!response.storing.status){showDebugMsgs(response.storing.details)}})}function postGenericStatus(statusVarName,statusVarValue){var postDataObject={};postDataObject[statusVarName]=statusVarValue;postDataObject.task="stream.saveEntity";$.post(jsonLiveSite,postDataObject,function(response){if(!response.storing.status){showDebugMsgs(response.storing.details)}})}function usersTabSt(Y){o=1;statusClassOp();$("#jchat_userstab_icon").addClass("jchat_user_offline");if(Y!=1){postStatus("offline")}$("#jchat_wall_popup").removeClass("jchat_tabopen");$("#jchat_userstab_popup").removeClass("jchat_tabopen");$("#jchat_userstab").removeClass("jchat_tabclick").removeClass("jchat_userstabclick");restartUpdateSession("buddylist","0")}function refreshActiveChatBoxes(){var Y="";$("span[id^=jchat_user_]").each(function(){var mixed=$(this).data("id");var Z=0;if($("#jchat_user_"+mixed+" .jchat_tabalert").length>0){Z=parseInt($("#jchat_user_"+mixed+" .jchat_tabalert").html())}Y+=mixed+"|"+Z+","});Y=Y.slice(0,-1);restartUpdateSession("activeChatboxes",Y)}function createPrivateMessagesPopup(ae,ab,Y,ad,statusAwayInfo,completeObject){if($("#jchat_user_"+ae).length>0){if(!$("#jchat_user_"+ae).hasClass("jchat_tabclick")){$(".jchat_tabalert").css("display","none");var mixed=800;if(e("initialize")==1||e("updatesession")==1){mixed=0}$("#jchat_user_"+ae).trigger("fetchMessages")}return}popupsReposition();if(ab.length>tabLength){shortname=ab.substr(0,tabLength)+"..."}else{shortname=ab}if(ab.length>headLength){longname=ab.substr(0,headLength)+"..."}else{longname=ab}var microSplacement=parseInt($("div[id^=jchat_userlist_]").index($("#jchat_userlist_"+ae)))/10;var splacement=parseInt($("div[id^=jchat_userlist_]").index($("#jchat_userlist_"+ae))+1)%2;var splacementDirection=splacement?2:-2;var popupPosition={left:(50+splacementDirection+microSplacement)+"%",top:(50+splacementDirection+microSplacement)+"%"};var marginPosition={left:"-115px",top:"-167px"};if(typeof popupPositions[ae]==="object"){popupPosition.left=popupPositions[ae].x+"px";popupPosition.top=popupPositions[ae].y+"px";marginPosition.left=0;marginPosition.top=0}var popupDimension={width:230,height:200};if(typeof popupDimensions[ae]==="object"){popupDimension.width=popupDimensions[ae].width+"px";popupDimension.height=popupDimensions[ae].height+"px"}var infoTrigger="";if(completeObject.isguest&&guestEnabledMode==2){infoTrigger='<div class="jchat_trigger_infoguest"></div>'}var historyTrigger="";if(!completeObject.isguest&&!isGuest&&messagesHistory){historyTrigger='<div class="jchat_trigger_history"></div>'}$("<div/>").attr("id","jchat_user_"+ae+"_popup").addClass("jchat_tabpopup jchat_tabopen").html('<div class="jchat_tabcontent messagelist"><div class="jchat_tabcontenttext private"></div><div class="jchat_tabcontentinput">'+writeElement+'</div><div class="jchat_trigger_emoticon"></div><div class="jchat_trigger_fileupload"></div><div class="jchat_trigger_export"></div><div class="jchat_trigger_delete"></div><div class="jchat_trigger_refresh"></div>'+infoTrigger+historyTrigger+"</div>").appendTo($("body"));if(!attachmentsEnabled||(isGuest&&!allowGuestFileupload)){$(".jchat_trigger_fileupload").remove()}if(completeObject.imbanned){$("#jchat_user_"+ae+"_popup .jchat_tabcontentinput").addClass("jchat_textarea_banned").html('<span class="banned_msg">'+jchat_banneduser+"</span>");$(".jchat_trigger_fileupload, .jchat_trigger_emoticon","#jchat_user_"+ae+"_popup").hide()}$("#jchat_user_"+ae+"_popup").css({left:popupPosition.left,top:popupPosition.top,"margin-left":marginPosition.left,"margin-top":marginPosition.top});$("#jchat_user_"+ae+"_popup").css({width:popupDimension.width});$("#jchat_user_"+ae+"_popup .jchat_tabcontenttext").css({height:popupDimension.height});$("<div/>").attr("id","jchat_user_"+ae+"_popup");$("#jchat_user_"+ae+"_popup .jchat_textarea").focusin(function(){T=ae});$(document).on("keydown","#jchat_user_"+ae+"_popup .jchat_textarea",function(jqEvent){return sendMessage(jqEvent,this,ae,completeObject.loggedid)});$(document).on("keyup","#jchat_user_"+ae+"_popup .jchat_textarea",function(jqEvent){return popup(jqEvent,this,ae)});$(".jchat_trigger_emoticon","#jchat_user_"+ae+"_popup").toggle(function(event){if(!!$('.jchat_tabcontent div[class$="tooltip"]',"#jchat_user_"+ae+"_popup").length){$('.jchat_tabcontent div[class$="tooltip"]',"#jchat_user_"+ae+"_popup").next().trigger("click")}emoticonsTooltip(this,"#jchat_user_"+ae+"_popup",ae);$(this).addClass("toggle_on")},function(event){$(".jchat_emoticonstooltip","#jchat_user_"+ae+"_popup").remove();$(this).removeClass("toggle_on")});$(".jchat_trigger_fileupload","#jchat_user_"+ae+"_popup").toggle(function(event){if(!!$('.jchat_tabcontent div[class$="tooltip"]',"#jchat_user_"+ae+"_popup").length){$('.jchat_tabcontent div[class$="tooltip"]',"#jchat_user_"+ae+"_popup").next().trigger("click")}uploadFileTooltip(this,"#jchat_user_"+ae+"_popup",ae,completeObject.loggedid);$(this).addClass("toggle_on")},function(event){$(".jchat_fileuploadtooltip","#jchat_user_"+ae+"_popup").remove();$(this).removeClass("toggle_on")});$(".jchat_trigger_infoguest","#jchat_user_"+ae+"_popup").toggle(function(event){if(!!$('.jchat_tabcontent div[class$="tooltip"]',"#jchat_user_"+ae+"_popup").length){$('.jchat_tabcontent div[class$="tooltip"]',"#jchat_user_"+ae+"_popup").next().trigger("click")}infoGuestTooltip(this,"#jchat_user_"+ae+"_popup",ae);$(this).addClass("toggle_on")},function(event){$(".jchat_infoguesttooltip","#jchat_user_"+ae+"_popup").remove();$(this).removeClass("toggle_on")});bindHistoryTooltipEvents(ae,completeObject);$(".jchat_trigger_export","#jchat_user_"+ae+"_popup").append("<a/>");$(".jchat_trigger_export a","#jchat_user_"+ae+"_popup").attr("href",htmlLiveSite+"&task=export.display&chatid="+ae);$(".jchat_trigger_delete","#jchat_user_"+ae+"_popup").bind("click",function(){deleteConversation(ae)});$("div.jchat_trigger_refresh","#jchat_user_"+ae+"_popup").click(function(event){var closureShortName=ab.length>tabLength?ab.substr(0,tabLength)+"...":ab;$("div.jchat_tab_shortname","#jchat_user_"+ae+"_popup").text(closureShortName);return fetchMessages(ae)});$("div.jchat_trigger_refresh","#jchat_user_"+ae+"_popup").mousedown(function(){$(this).addClass("jchat_refresh_mousedown")}).mouseup(function(){$(this).removeClass("jchat_refresh_mousedown")});$("#jchat_user_"+ae+"_popup .jchat_tabtitle").append('<div class="jchat_closebox"></div><br clear="all"/>');$("#jchat_user_"+ae+"_popup .jchat_tabtitle .jchat_closebox").mouseenter(function(){$(this).addClass("jchat_chatboxmouseoverclose");$("#jchat_user_"+ae+"_popup .jchat_tabtitle").removeClass("jchat_chatboxtabtitlemouseover")});$("#jchat_user_"+ae+"_popup .jchat_tabtitle .jchat_closebox").mouseleave(function(){$(this).removeClass("jchat_chatboxmouseoverclose");$("#jchat_user_"+ae+"_popup .jchat_tabtitle").addClass("jchat_chatboxtabtitlemouseover")});$("#jchat_user_"+ae+"_popup .jchat_tabtitle .jchat_closebox").click(function(){$("#jchat_user_"+ae+"_popup").remove();$("#jchat_user_"+ae).remove();if(T==ae){T="";restartUpdateSession("openChatboxId","")}popupsReposition();refreshActiveChatBoxes()});$("#jchat_user_"+ae+"_popup .jchat_tabtitle").click(function(){$("#jchat_user_"+ae).trigger("fetchMessages")});$("#jchat_user_"+ae+"_popup .jchat_tabtitle").mouseenter(function(){$(this).addClass("jchat_chatboxtabtitlemouseover")});$("#jchat_user_"+ae+"_popup .jchat_tabtitle").mouseleave(function(){$(this).removeClass("jchat_chatboxtabtitlemouseover")});shortname=completeObject.profilelink!==null?'<a href="'+completeObject.profilelink+'" target="_blank">'+shortname+"</a>":shortname;$("<span/>").attr("id","jchat_user_"+ae).attr("data-id",ae).addClass("jchat_tab jchat_tabclick jchat_usertabclick").html('<div class="jchat_closebox_bottom_status jchat_'+Y+'">'+statusAwayInfo+'</div><div class="jchat_tab_shortname">'+shortname+"</div>").prependTo($("#jchat_user_"+ae+"_popup"));$("#jchat_user_"+ae).attr("data-loggedid",completeObject.loggedid);var maximizeButtonHtml='<div class="jchat_maximizebox_bottom"></div>';if(!maximizeButton||(maximizeButton>1&&!jchatDetectMobileDevice(maximizeButton))){maximizeButtonHtml=""}$("#jchat_user_"+ae).append('<div class="jchat_closebox_bottom"></div>'+maximizeButtonHtml+'<div class="jchat_minimizebox_bottom"></div>');$("#jchat_user_"+ae+" .jchat_closebox_bottom").mouseenter(function(){$(this).addClass("jchat_closebox_bottomhover")});$("#jchat_user_"+ae+" .jchat_closebox_bottom").mouseleave(function(){$(this).removeClass("jchat_closebox_bottomhover")});$("#jchat_user_"+ae+" .jchat_closebox_bottom").click(function(){if($("#jchat_user_"+ae+"_popup").hasClass("maximized")){popupDimensions[ae]={width:230,height:200}}$("#jchat_user_"+ae+"_popup").remove();$("#jchat_user_"+ae).remove();if(T==ae){T="";restartUpdateSession("openChatboxId","")}popupsReposition();refreshActiveChatBoxes()});$("#jchat_user_"+ae+" .jchat_minimizebox_bottom").on("hover",function(){$(this).toggleClass("jchat_minimizebox_bottomhover")});$("#jchat_user_"+ae+" .jchat_maximizebox_bottom").on("hover",function(){$(this).toggleClass("jchat_maximizebox_bottomhover")});$("#jchat_user_"+ae+" .jchat_minimizebox_bottom").click(function(){$(this).toggleClass("minimized");var currentMinimizedState=!$(this).data("minimized");$(this).data("minimized",currentMinimizedState);popupState[ae]=currentMinimizedState;$.jStorage.set("popupState",popupState);if(currentMinimizedState){$("#jchat_user_"+ae+"_popup").toggleClass("minimized");$("#jchat_user_"+ae+"_popup .ui-resizable-handle").toggle()}$("#jchat_user_"+ae+"_popup .jchat_tabcontent.messagelist").slideToggle(300,"swing",function(){$("#jchat_user_"+ae+"_popup .jchat_tabcontenttext").scrollTop($("#jchat_user_"+ae+"_popup .jchat_tabcontenttext")[0].scrollHeight);if(!currentMinimizedState){$("#jchat_user_"+ae+"_popup").toggleClass("minimized");$("#jchat_user_"+ae+"_popup .ui-resizable-handle").toggle()}})});$("#jchat_user_"+ae+" .jchat_maximizebox_bottom").click(function(){$(this).toggleClass("maximized");var currentMaximizedState=!$(this).data("maximized");$(this).data("maximized",currentMaximizedState);if(currentMaximizedState){$("#jchat_user_"+ae+"_popup").toggleClass("maximized");$("#jchat_user_"+ae+"_popup .ui-resizable-handle").toggle();$("#jchat_user_"+ae+"_popup").css({top:0,left:0,"margin-left":0,"margin-top":0,width:"100%",height:"100%"});var setDimensions=function(){var viewportWidth=(window.innerWidth?window.innerWidth:$(window).width())-28;var viewportHeight=(window.innerHeight?window.innerHeight:$(window).height())-92;$(".jchat_tabcontenttext.private","#jchat_user_"+ae+"_popup").width(viewportWidth);$(".jchat_tabcontenttext.private","#jchat_user_"+ae+"_popup").height(viewportHeight);popupDimensions[ae]={width:viewportWidth,height:viewportHeight}};setDimensions();$(window).on("resize.jchat",function(jqEvent){setDimensions()});popupsReposition(true);$("#jchat_user_"+ae+"_popup").draggable("disable");$("div[id^=jchat_user_]").removeClass("maximized_hover");$("div[id^=jchat_user_]").each(function(index,elem){var thisID=$(elem).attr("id");var hasMaximizedClass=$(elem).hasClass("maximized");if(hasMaximizedClass&&thisID!="jchat_user_"+ae+"_popup"){$(".jchat_maximizebox_bottom",elem).trigger("click")}})}else{$("#jchat_user_"+ae+"_popup").toggleClass("maximized");$("#jchat_user_"+ae+"_popup .ui-resizable-handle").toggle();var originalTopPosition="50%";var originalLeftPosition="50%";var originalWidth=230;var originalHeight=200;var originalMarginLeft=marginPosition.left;var originalMarginTop=marginPosition.top;popupDimensions[ae]={width:originalWidth,height:originalHeight};if(typeof popupPositions[ae]==="object"){originalTopPosition=popupPositions[ae].y;originalLeftPosition=popupPositions[ae].x;originalMarginLeft=0;originalMarginTop=0}$("#jchat_user_"+ae+"_popup").css({top:originalTopPosition,left:originalLeftPosition,"margin-left":originalMarginLeft,"margin-top":originalMarginTop,width:originalWidth,height:"293px"});$(".jchat_tabcontenttext.private","#jchat_user_"+ae+"_popup").innerWidth(originalWidth-4);$(".jchat_tabcontenttext.private","#jchat_user_"+ae+"_popup").height(originalHeight);$(window).off("resize.jchat");popupsReposition();$("#jchat_user_"+ae+"_popup").draggable("enable");$("div[id^=jchat_user_]").removeClass("maximized_hover")}$("#jchat_user_"+ae+"_popup .jchat_tabcontenttext").scrollTop($("#jchat_user_"+ae+"_popup .jchat_tabcontenttext")[0].scrollHeight)});if(popupState[ae]===true){$("#jchat_user_"+ae+" .jchat_minimizebox_bottom").addClass("minimized").data("minimized",popupState[ae]);$("#jchat_user_"+ae+"_popup .jchat_tabcontent.messagelist").toggle()}$("#jchat_user_"+ae).mouseenter(function(){$(this).addClass("jchat_tabmouseover");$("#jchat_user_"+ae+" div").addClass("jchat_tabmouseovertext")});$("#jchat_user_"+ae).mouseleave(function(){$(this).removeClass("jchat_tabmouseover");$("#jchat_user_"+ae+" div").removeClass("jchat_tabmouseovertext")});$("#jchat_user_"+ae).bind("fetchMessages",function(){if($("#jchat_user_"+ae+" .jchat_tabalert").length>0){$("#jchat_user_"+ae+" .jchat_tabalert").remove();refreshActiveChatBoxes()}if($("div.jchat_avatar_upload_tooltip").length>0){$("#jchat_avatar").trigger("click")}if($("div.jchat_emoticonstooltip","#jchat_wall_popup").length>0){$("div.jchat_trigger_emoticon","#jchat_wall_popup").trigger("click")}$(this).addClass("jchat_tabclick").addClass("jchat_usertabclick");restartUpdateSession("openChatboxId",ae);T=ae;fetchMessages(ae);$("#jchat_user_"+ae+"_popup .jchat_tabcontenttext").scrollTop($("#jchat_user_"+ae+"_popup .jchat_tabcontenttext")[0].scrollHeight);if(!firstCall&&!jchatHasTouch()){$("#jchat_user_"+ae+"_popup .jchat_textarea").focus()}});$("#jchat_user_"+ae).trigger("fetchMessages");if(!isTabFocused){$("title").text(ab+jchat_newmessage_tab)}refreshActiveChatBoxes();$("#jchat_user_"+ae+"_popup").draggable({handle:"#jchat_user_"+ae,drag:function(event,ui){var isMaximized=$("#jchat_wall_popup").hasClass("maximized")||$(this).hasClass("maximized");popupsReposition(isMaximized,this)},start:function(event,ui){$(this).addClass("dragging")},stop:function(event,ui){popupPositions[ae]={x:ui.helper.offset().left-$(window).scrollLeft(),y:ui.helper.offset().top-$(window).scrollTop()};$.jStorage.set("popupPositions",popupPositions);$(this).removeClass("dragging")}});if(resizableChatboxes&&!jchatHasTouch()){$("#jchat_user_"+ae+"_popup").resizable({handles:"se",alsoResize:"#jchat_user_"+ae+"_popup .jchat_tabcontenttext.private",minHeight:293,minWidth:230,start:function(event,ui){},stop:function(event,ui){var parentContainerOfText=$(ui.element).get(0);var targetElem=$(".jchat_tabcontenttext",parentContainerOfText).get(0);var defaultChatboxHeight=$(".jchat_tabcontenttext",parentContainerOfText).get(0).clientHeight-10;popupDimensions[ae]={width:ui.size.width,height:defaultChatboxHeight};$.jStorage.set("popupDimensions",popupDimensions)},resize:function(event,ui){popupsReposition();var parentContainerOfText=$(ui.element).get(0);if(ui.originalSize.height>ui.size.height){$(".jchat_tabcontenttext",parentContainerOfText).scrollTop($(".jchat_tabcontenttext",parentContainerOfText)[0].scrollHeight)}if($(".jchat_tabcontenttext iframe",parentContainerOfText).height()<150){$(".jchat_tabcontenttext iframe",parentContainerOfText).height(150)}}})}makeSidebarResizable();if(popupState[ae]===true){$("#jchat_user_"+ae+"_popup .ui-resizable-handle").toggle();$("#jchat_user_"+ae+"_popup").toggleClass("minimized")}if($.browser.msie&&$.browser.version<=8){}else{jchatInitTouchEvents($("#jchat_user_"+ae).get(0));if(resizableChatboxes&&!jchatHasTouch()){jchatInitTouchEvents($("#jchat_user_"+ae+"_popup div.ui-resizable-handle").get(0))}}if(jchatHasTouch()){$("#jchat_user_"+ae).css("background-position","80% -850px");$("div.ui-resizable-handle").css({width:"36px",height:"36px","background-position":"22px -1402px"});$("div.jchat_tabcontent").css("border-bottom","none")}}function fetchMessages(Y){$.ajax({async:true,url:jsonLiveSite,data:{chatbox:Y,task:"stream.display"},type:"post",cache:false,dataType:"json",success:function(ab){if(ab){$("#jchat_user_"+Y+"_popup .jchat_tabcontenttext").html("");var Z="";$.each(ab,function(ac,ad){if(ac=="messages"){$.each(ad,function(af,ae){if(ae.id>n){n=ae.id}var selfClass="";if(ae.self==1){if(my_avatar!==undefined&&my_avatar!==null&&my_avatar!==""&&avatarEnabled===true){fromPlaceholder='<img alt="'+jchat_you+my_username+'" data-time="'+ae.time+'" width="32px" height="32px" src="'+my_avatar+'" />'}else{fromPlaceholder="<strong>"+my_username+"</strong>"}selfClass=" selfmessage"}else{var userName=$("#jchat_userlist_"+Y).triggerHandler("getname");var userAvatar=$("#jchat_userlist_"+Y).triggerHandler("getavatar");if(userAvatar===undefined||userAvatar===null||userAvatar===""){userAvatar=ae.avatar}if(userName===undefined||userName===null||userName===""){if(ae.fromuser.length>chatLength){userName=ae.fromuser.substr(0,chatLength)+"..."}else{userName=ae.fromuser}}if(userAvatar!==undefined&&userAvatar!==null&&userAvatar!==""&&avatarEnabled===true){fromPlaceholder='<img alt="'+userName+'" data-time="'+ae.time+'" width="32px" height="32px" src="'+userAvatar+'" />'}else{fromPlaceholder="<strong>"+userName+"</strong>"}}if(typeof ae.profilelink!=="undefined"&&ae.profilelink!==""&&ae.profilelink!==null){fromPlaceholder='<a href="'+ae.profilelink+'" target="_blank">'+fromPlaceholder+"</a>"}if(ae.type=="file"){ae.message=trasformMsgFile(ae.message,ae.id,ae.self,ae.from,ae.status,false)}else{ae.message=strip_tags(ae.message,allowMediaObjects);ae.message=ae.message.replace(/&/gi,"&amp;")}Z+=('<div class="jchat_chatboxmessage'+selfClass+'" id="jchat_message_'+ae.id+'"><span class="jchat_chatboxmessagefrom">'+fromPlaceholder+'</span><span class="jchat_chatboxmessagecontent'+selfClass+'">'+ae.message+"</span></div>")})}});$("#jchat_user_"+Y+"_popup .jchat_tabcontenttext").append(Z);$("#jchat_user_"+Y+"_popup .jchat_tabcontenttext").scrollTop($("#jchat_user_"+Y+"_popup .jchat_tabcontenttext")[0].scrollHeight)}$("span.jchat_chatboxmessagefrom img").mouseover(function(event){avatarTooltip(this,$(this).attr("alt"),$(this).data("time"))}).mouseout(function(event){$("#jchat_avatartooltip").remove()})}})}function fetchWallMessages(historyMessages){$("#jchat_wall_popup").append("<img/>").children("img").attr("src",jchat_livesite+"components/com_jchat/images/loading.gif").css({position:"absolute",top:"10%",left:"38%",width:"64px"}).addClass("waiter");$.ajax({async:true,url:jsonLiveSite,data:{wall:true,task:"stream.display",download_history:historyMessages},type:"post",cache:false,dataType:"json",success:function(ab){if(ab&&typeof(ab.wallmessages)!=="undefined"){$("#jchat_wall_popup div.jchat_tabcontenttext").html("");var Z="";$.each(ab.wallmessages,function(af,ae){var selfClass="";if(ae.self==1){if(my_avatar!==undefined&&my_avatar!==null&&my_avatar!==""&&avatarEnabled===true){fromPlaceholder='<img alt="'+jchat_you+my_username+'" data-time="'+ae.time+'" width="32px" height="32px" src="'+my_avatar+'" />'}else{fromPlaceholder="<strong>"+my_username+"</strong>"}selfClass=" selfmessage"}else{var userName=$("#jchat_userlist_"+ae.fromuserid).triggerHandler("getname");var userAvatar=$("#jchat_userlist_"+ae.fromuserid).triggerHandler("getavatar");if(userAvatar===undefined||userAvatar===null||userAvatar===""){userAvatar=ae.avatar}if(userName===undefined||userName===null||userName===""){if(ae.fromuser.length>chatLength){userName=ae.fromuser.substr(0,chatLength)+"..."}else{userName=ae.fromuser}}if(userAvatar!==undefined&&userAvatar!==null&&userAvatar!==""&&!userAvatar.match(/default_other.png/)&&avatarEnabled===true){fromPlaceholder='<img alt="'+userName+'" data-time="'+ae.time+'" width="32px" height="32px" src="'+userAvatar+'" />'}else{fromPlaceholder="<strong>"+userName+"</strong>"}}if(typeof ae.profilelink!=="undefined"&&ae.profilelink!==""&&ae.profilelink!==null){fromPlaceholder='<a href="'+ae.profilelink+'" target="_blank">'+fromPlaceholder+"</a>"}if(ae.type=="file"){ae.message=trasformMsgFile(ae.message,ae.id,ae.self,ae.from,ae.status,false)}else{ae.message=strip_tags(ae.message,allowMediaObjects);ae.message=ae.message.replace(/&/gi,"&amp;")}Z+=('<div class="jchat_chatboxmessage'+selfClass+'" id="jchat_message_'+ae.id+'"><span class="jchat_chatboxmessagefrom">'+fromPlaceholder+'</span><span class="jchat_chatboxmessagecontent'+selfClass+'">'+ae.message+"</span></div>")});$("#jchat_wall_popup div.jchat_tabcontenttext").append(Z);if(historyMessages){$("#jchat_wall_popup div.jchat_tabcontenttext").animate({scrollTop:0},300,"swing")}else{$("#jchat_wall_popup div.jchat_tabcontenttext").scrollTop($("#jchat_wall_popup div.jchat_tabcontenttext")[0].scrollHeight)}}$("span.jchat_chatboxmessagefrom img","#jchat_wall_popup").mouseover(function(event){avatarTooltip(this,$(this).attr("alt"),$(this).data("time"))}).mouseout(function(event){$("#jchat_avatartooltip").remove()});$("#jchat_wall_popup img.waiter").remove()}})}function fetchHistoryMessages(loggedid,userid,messagesPeriod,minMessageId){$("#jchat_user_"+userid+"_popup").append("<img/>").children("img").attr("src",jchat_livesite+"components/com_jchat/images/loading.gif").css({position:"absolute",top:"10%",left:"38%",width:"64px"}).addClass("waiter");var historyFetchPromise=$.Deferred(function(defer){$.ajax({type:"post",url:jsonLiveSite,dataType:"json",cache:false,context:this,data:{task:"stream.showHistory",from_loggedid:loggedid,from_userid:userid,msgs_period:messagesPeriod,min_message_id:minMessageId}}).done(function(data,textStatus,jqXHR){if(!data.status){defer.reject(data.details,textStatus);return false}if(!data.messages.length){defer.reject(jchat_nomessages_available,textStatus);return false}if(data.status&&data.messages.length){defer.resolve(data.messages)}}).fail(function(jqXHR,textStatus,errorThrown){var genericStatus=textStatus[0].toUpperCase()+textStatus.slice(1);defer.reject("-"+genericStatus+"- "+errorThrown)}).always(function(){$("#jchat_user_"+userid+"_popup img.waiter").remove()})}).promise();historyFetchPromise.then(function(messages){var messagesToPrepend="";$.each(messages,function(index,message){var selfClass="";if(message.self==1){if(my_avatar!==undefined&&my_avatar!==null&&my_avatar!==""&&avatarEnabled===true){fromPlaceholder='<img alt="'+jchat_you+my_username+'" data-time="'+message.time+'" width="32px" height="32px" src="'+my_avatar+'" />'}else{fromPlaceholder="<strong>"+my_username+"</strong>"}selfClass=" selfmessage"}else{var userName=$("#jchat_userlist_"+userid).triggerHandler("getname");var userAvatar=$("#jchat_userlist_"+userid).triggerHandler("getavatar");if(userName===undefined||userName===null||userName===""){if(message.fromusername.length>chatLength){userName=message.fromusername.substr(0,chatLength)+"..."}else{userName=message.fromusername}}if(userAvatar!==undefined&&userAvatar!==null&&userAvatar!==""&&avatarEnabled===true){fromPlaceholder='<img alt="'+userName+'" data-time="'+message.time+'" width="32px" height="32px" src="'+userAvatar+'" />'}else{fromPlaceholder="<strong>"+userName+"</strong>"}}if(typeof message.profilelink!=="undefined"&&message.profilelink!==""&&message.profilelink!==null){fromPlaceholder='<a href="'+message.profilelink+'" target="_blank">'+fromPlaceholder+"</a>"}if(message.type=="file"){message.message=trasformMsgFile(message.message,message.id,message.self,message.from,message.status,false)}else{message.message=strip_tags(message.message,allowMediaObjects);message.message=message.message.replace(/&/gi,"&amp;")}messagesToPrepend+=('<div class="jchat_chatboxmessage'+selfClass+'" id="jchat_message_'+message.id+'"><span class="jchat_chatboxmessagefrom">'+fromPlaceholder+'</span><span class="jchat_chatboxmessagecontent'+selfClass+'">'+message.message+"</span></div>")});$("#jchat_user_"+userid+"_popup .jchat_tabcontenttext").prepend(messagesToPrepend);$("#jchat_user_"+userid+"_popup .jchat_tabcontenttext").animate({scrollTop:0},300,"swing");$("span.jchat_chatboxmessagefrom img").mouseover(function(event){avatarTooltip(this,$(this).attr("alt"),$(this).data("time"))}).mouseout(function(event){$("#jchat_avatartooltip").remove()})},function(errorText,error){injectFloatingMsg(errorText)})}function listaUtenti(ab,Z,status,mixed,completeObject,contactExit){if(mixed==""){mixed=jchat_defaultstatus}var statusAwayInfo="";if(status.indexOf("|")>0){var statusInfoArray=status.split("|");status=statusInfoArray[0];var statusAwayTime=statusInfoArray[1];statusAwayInfo='<span class="jchat_timeinfo">'+statusAwayTime+"</span>"}else{if(status==="available"&&!completeObject.lastmessagetime){status="neveractive"}}var exists=!!($("#jchat_userlist_"+ab).length);var wasOwned=$("#jchat_userlist_"+ab+" span.jchat_contact").attr("data-owned");var wasContact=$("#jchat_userlist_"+ab+" span.jchat_contact").attr("data-contact");var isInitialize=e("initialize")=="0"?false:true;if($("#jchat_userlist_"+ab).length>0){$("#jchat_user_"+ab+" .jchat_closebox_bottom_status").removeClass("jchat_available");$("#jchat_user_"+ab+" .jchat_closebox_bottom_status").removeClass("jchat_away");$("#jchat_user_"+ab+" .jchat_closebox_bottom_status").removeClass("jchat_offline");$("#jchat_user_"+ab+" .jchat_closebox_bottom_status").removeClass("jchat_disconnected");$("#jchat_user_"+ab+" .jchat_closebox_bottom_status").addClass("jchat_"+status);$("#jchat_user_"+ab+" .jchat_closebox_bottom_status").html(statusAwayInfo);if(completeObject.imbanned){$("#jchat_user_"+ab+"_popup .jchat_tabcontentinput").addClass("jchat_textarea_banned").html('<span class="banned_msg">'+jchat_banneduser+"</span>");$(".jchat_trigger_fileupload, .jchat_trigger_emoticon","#jchat_user_"+ab+"_popup").hide()}else{if($("#jchat_user_"+ab+"_popup .jchat_tabcontentinput").hasClass("jchat_textarea_banned")){$("#jchat_user_"+ab+"_popup .jchat_tabcontentinput").removeClass("jchat_textarea_banned").html(writeElement);$(".jchat_trigger_fileupload, .jchat_trigger_emoticon","#jchat_user_"+ab+"_popup").show()}}if(!completeObject.isguest&&!isGuest&&!$("#jchat_user_"+ab+"_popup .jchat_trigger_history").length){$('<div class="jchat_trigger_history"></div>').appendTo("#jchat_user_"+ab+"_popup div.messagelist").on("mouseover",function(event){triggerGenericPopover("#jchat_trigger_history_tooltip",this,jchat_trigger_history)}).on("mouseout",function(event){$("#jchat_trigger_history_tooltip").css("display","none")});bindHistoryTooltipEvents(ab,completeObject)}$("#jchat_userlist_"+ab).remove()}if(Z.length>tabLength){shortname=Z.substr(0,tabLength)+"..."}else{shortname=Z}if($("div.jchat_tab_shortname a","#jchat_user_"+ab+"_popup").length){$("div.jchat_tab_shortname a","#jchat_user_"+ab+"_popup").text(shortname)}else{$("div.jchat_tab_shortname","#jchat_user_"+ab+"_popup").text(shortname)}if(Z.length>buddyLength){longname=Z.substr(0,buddyLength)+"..."}else{longname=Z}var userAvatar="";if(typeof completeObject.avatar!=="undefined"&&completeObject.avatar!==""){if(completeObject.avatar!==null&&avatarEnabled===true){userAvatar='<img width="32px" height="32px"  src="'+completeObject.avatar+'" />'}}$("<div/>").attr("id","jchat_userlist_"+ab).addClass("jchat_userlist").html('<span class="jchat_userscontentname">'+userAvatar+'<span class="jchat_banning"></span>'+longname+'</span><span class="jchat_contact"></span>'+statusAwayInfo+'<span class="jchat_userscontentdot jchat_'+status+'"></span>').data("id",ab).appendTo($("#jchat_userstab_popup .jchat_tabcontent .jchat_userscontent .jchat_userslist_"+status));if(privateChatEnabled){$("#jchat_userlist_"+ab).mouseover(function(){$(this).addClass("jchat_userlist_hover")});$("#jchat_userlist_"+ab).mouseout(function(){$(this).removeClass("jchat_userlist_hover")});$("#jchat_userlist_"+ab).click(function(){createPrivateMessagesPopup(ab,Z,status,mixed,statusAwayInfo,completeObject)});$("#jchat_userlist_"+ab).dblclick(function(){createPrivateMessagesPopup(ab,Z,status,mixed,statusAwayInfo,completeObject)})}else{$("#jchat_userlist_"+ab).css({cursor:"auto"})}$("span.jchat_contact","#jchat_userlist_"+ab).attr("data-userid",ab);$("span.jchat_banning","#jchat_userlist_"+ab).attr("data-userid",ab);if(completeObject.iscontact&&completeObject.isowner){$("span.jchat_contact","#jchat_userlist_"+ab).attr("data-contact",1).attr("data-name",completeObject.name);$("span.jchat_contact","#jchat_userlist_"+ab).addClass("active").attr("data-text",jchat_remove);if(!wasContact&&!isInitialize&&exists){injectFloatingMsg(jchat_groupchat_request_accepted_owner,completeObject.name);msgNotify.playSentFile()}}else{if(completeObject.iscontact||completeObject.isowner){$("span.jchat_contact","#jchat_userlist_"+ab).attr("data-owned",1);$("span.jchat_contact","#jchat_userlist_"+ab).addClass("owned").attr("data-text",jchat_pending);if(!wasOwned&&!isInitialize&&exists){injectFloatingMsg(jchat_groupchat_request_received,completeObject.name);msgNotify.playSentFile()}}else{$("span.jchat_contact","#jchat_userlist_"+ab).attr("data-contact",0);$("span.jchat_contact","#jchat_userlist_"+ab).addClass("noactive").attr("data-text",jchat_invite)}}$("#jchat_userlist_"+ab).on("click dblclick","span.jchat_contact",function(event){event.stopPropagation();var userid=$(this).attr("data-userid");var activeContact=$(this).attr("data-contact");var activeOwned=$(this).attr("data-owned");var isClient=(completeObject.iscontact&&!completeObject.isowner)?true:false;var isOwner=(completeObject.isowner&&!completeObject.iscontact)?true:false;if(isClient){$(this).removeClass("owned").addClass("noactive").attr("data-contact",0).attr("data-owned",0);updateGroupChatUsers("groupchat.deleteEntity",userid);injectFloatingMsg(jchat_groupchat_request_removed,completeObject.name)}else{if(isOwner){if(activeContact){$(this).removeClass("owned").addClass("noactive").attr("data-contact",0).attr("data-owned",0);updateGroupChatUsers("groupchat.deleteEntity",userid);injectFloatingMsg(jchat_groupchat_request_removed,completeObject.name)}else{if(activeOwned){$(this).removeClass("noactive").addClass("active").attr("data-owned",0).attr("data-contact",1).attr("data-name",completeObject.name);updateGroupChatUsers("groupchat.saveEntity",userid);injectFloatingMsg(jchat_groupchat_request_accepted)}}}else{if(activeContact!=1&&activeOwned!=1){$(this).removeClass("noactive").addClass("owned").attr("data-owned",1);updateGroupChatUsers("groupchat.saveEntity",userid);injectFloatingMsg(jchat_groupchat_request_sent,completeObject.name)}else{$(this).removeClass("active").addClass("noactive").attr("data-contact",0).attr("data-owned",0);updateGroupChatUsers("groupchat.deleteEntity",userid);injectFloatingMsg(jchat_groupchat_request_removed,completeObject.name)}}}});if(completeObject.isbanned){$("span.jchat_banning","#jchat_userlist_"+ab).attr("data-banned",1).addClass("banned")}$("#jchat_userlist_"+ab).on("click dblclick","span.jchat_banning",function(event){event.stopPropagation();var bannedUserSessionId=$(this).data("userid");var bannedCurrentState=!$(this).data("banned");var bannedObject={};bannedObject.userSessionId=bannedUserSessionId;bannedObject.currentState=bannedCurrentState;postGenericStatus("bannedinfo",JSON.stringify(bannedObject));$(this).toggleClass("banned")});$("#jchat_userlist_"+ab).bind("addmessage",function(event,testomessaggio,af,ae,idmessaggio,messageObject,lastMessageReached){createPrivateMessagesPopup(ab,Z,status,mixed,statusAwayInfo,completeObject);if(!messageObject.id&&T==ab&&af==1){var selfClass="";if(af==1){if(my_avatar!==undefined&&my_avatar!==null&&my_avatar!==""&&avatarEnabled===true){fromPlaceholder='<img alt="'+jchat_you+my_username+'" data-time="'+messageObject.time+'" width="32px" height="32px" src="'+my_avatar+'" />'}else{fromPlaceholder="<strong>"+my_username+"</strong>"}selfClass=" selfmessage"}testomessaggio=strip_tags(testomessaggio,allowMediaObjects);testomessaggio=testomessaggio.replace(/&/gi,"&amp;");if($("#jchat_message_"+idmessaggio).length>0){}else{$("#jchat_user_"+ab+"_popup .jchat_tabcontenttext").append('<div class="jchat_chatboxmessage'+selfClass+'" id="jchat_message_'+idmessaggio+'"><span class="jchat_chatboxmessagefrom">'+fromPlaceholder+'</span><span class="jchat_chatboxmessagecontent'+selfClass+'">'+testomessaggio+"</span></div>");$("span.jchat_chatboxmessagefrom img").mouseover(function(event){avatarTooltip(this,$(this).attr("alt"),$(this).data("time"))}).mouseout(function(event){$("#jchat_avatartooltip").remove()})}}if(T!=ab&&ae==0){tabAlert(ab,1,1,messageObject,lastMessageReached)}else{if(audio==1&&af==0&&ae==0&&messageObject.type!="file"){msgNotify.playMessageAlert()}else{if(audio==1&&af==0&&ae==0&&messageObject.type=="file"){msgNotify.playSentFile()}}}if(ae==0){var target=$("#jchat_user_"+messageObject.from+"_popup .jchat_textarea");if(target.length&&!$(target).is(":focus")&&!$(target).data("isblinking")){$(target).blink();$(target).data("isblinking",true)}}});$("#jchat_userlist_"+ab).bind("getname",function(ac){if(Z.length>chatLength){return Z.substr(0,chatLength)+"..."}else{return Z}});$("#jchat_userlist_"+ab).bind("getavatar",function(ac){return completeObject.avatar});if(completeObject.skypeid){injectSkypeControls(completeObject)}}function tabAlert(mixed,Y,Z,messageObject,lastMessageReached){if(audio==1&&messageObject.type!="file"){msgNotify.playMessageAlert()}else{if(audio==1&&messageObject.type=="file"){msgNotify.playSentFile()}}}function initializeDom(){$("<span/>").attr("id","jchat_userstab").addClass("jchat_tab").html('<span id="jchat_userstab_icon"></span><span id="jchat_userstab_text" style="float:left">'+chatTitle+"</span>").appendTo($("#jchat_base"));$("<span/>").attr("id","jchat_closesidebarbutton").addClass("jchat_tab").addClass("jchat_exitimages").appendTo($("#jchat_userstab"));$("<span/>").attr("id","jchat_optionsbutton").addClass("jchat_tab").addClass("jchat_optionsimages").appendTo($("#jchat_userstab"));$("<span/>").attr("id","jchat_maximizebutton").attr("data-translation","jchat_maximizebutton").addClass("jchat_tab").addClass("jchat_maximizeimages").appendTo($("#jchat_userstab"));$("<div/>").attr("id","jchat_userstab_popup").addClass("jchat_tabpopup").css("display","none").html('<div class="jchat_userstabtitle">'+jchat_privatechat+'<input id="jchat_users_search" type="text" value="'+jchat_search+'"/><div id="jchat_myusername"></div></div><div class="jchat_tabcontent userslist"><div class="jchat_userscontent"><div class="jchat_userslist_available"></div><div class="jchat_userslist_away"></div><div class="jchat_userslist_neveractive"></div></div>').appendTo($(jchatTargetElement));$("#jchat_userstab").mouseover(function(){$(this).addClass("jchat_tabmouseover")});$("#jchat_userstab").mouseout(function(){$(this).removeClass("jchat_tabmouseover")});$(document).on("click","#jchat_userstab",function(event){if(o==1){o=0;$("#jchat_userstab_text").html(chatTitle);ajaxReceive();$("#jchat_optionsbutton_popup .available").click()}s.options=0;$("#jchat_wall_popup").toggleClass("jchat_tabopen");if($(this).hasClass("jchat_tabclick")){restartUpdateSession("buddylist","0")}else{restartUpdateSession("buddylist","1");makeSidebarResizable();if($("#jchat_wall_popup div.jchat_tabcontenttext").length){$("#jchat_wall_popup div.jchat_tabcontenttext").scrollTop($("#jchat_wall_popup div.jchat_tabcontenttext")[0].scrollHeight)}}$("#jchat_userstab_popup").css("right","0").css("bottom","0");$(this).toggleClass("jchat_tabclick").toggleClass("jchat_userstabclick");if(buddyListVisible){$("#jchat_userstab_popup").toggleClass("jchat_tabopen")}$("#jchat_newpublic_msg").remove();clearInterval(wallMessagesAlertInterval)});var defaultGenericTooltips=["jchat_trigger_emoticon","jchat_trigger_fileupload","jchat_trigger_export","jchat_trigger_delete","jchat_trigger_refresh","jchat_trigger_skypesave","jchat_trigger_skypedelete","jchat_trigger_override_name","jchat_trigger_infoguest","jchat_trigger_room","jchat_roomname","jchat_roomcount","jchat_banning","jchat_trigger_history","jchat_trigger_history_wall","jchat_skype"];$.each(defaultGenericTooltips,function(k,elem){$(document).on("mouseover","."+elem,function(event){triggerGenericPopover("#"+elem+"_tooltip",this,eval(elem))}).on("mouseout","."+elem,function(event){$("#"+elem+"_tooltip").css("display","none")})});$(document).on("mouseover",".jchat_contact",function(event){triggerGenericPopover("#jchat_contact_tooltip",this)}).on("mouseout",".jchat_contact",function(event){$("#jchat_contact_tooltip").css("display","none")});$("#jchat_users_search").focusin(function(){$(this).val("")}).focusout(function(){$(this).val(jchat_search);forceBuddylistRefresh=0}).keyup(function(){restartUpdateSession("buddylist","1");forceBuddylistRefresh=1});$("head").append('<style>.jchat_tab_shortname a:hover::before{ content:"'+jchat_userprofile_link+'" }</style>');$(window).focus(function(){isTabFocused=true;$("title").text(originalPageTitle)});$(window).blur(function(){isTabFocused=false})}function initializeOptionsDiv(){$("<div/>").attr("id","jchat_optionsbutton_popup").addClass("jchat_tabpopup").css("display","none").html('<div class="jchat_userstabtitle">'+jchat_optionsbutton+'</div><div class="jchat_tabcontent"><span style="float:left" class="jchat_user_available"></span><span class="jchat_optionsstatus available">'+jchat_available+'</span><br clear="all"/><span class="jchat_optionsstatus2 jchat_user_offline"></span><span class="jchat_optionsstatus offline">'+jchat_statooffline+'</span><br clear="all"/><div class="jchat_override_name"><span class="jchat_options_override_name">'+jchat_insert_override_name+'</span></div><div><input type="text" id="override_name" value=""/><div id="jchat_trigger_override_name" class="jchat_trigger_override_name"></div><br clear="all"/></div><div id="jchat_avatar" class="jchat_avatar">Avatar</div><div class="jchat_sounds">'+jchat_audio_onoff+'</div><br clear="all"/><div class="jchat_skype"><span class="jchat_options_skype">'+jchat_insert_skypeid+'</span></div><div><input type="text" id="skype_id" value=""/><div id="jchat_trigger_skypesave" class="jchat_trigger_skypesave"></div><div id="jchat_trigger_skypedelete" class="jchat_trigger_skypedelete"></div></div>').appendTo($(jchatTargetElement));$("#jchat_optionsbutton_popup .available").click(function(Y){statusClassOp();$("#jchat_userstab_icon").addClass("jchat_user_available2");$(this).css("text-decoration","underline");postStatus("available")});$("#jchat_optionsbutton_popup .offline").click(function(Y){usersTabSt();$(this).css("text-decoration","underline")});$("#jchat_trigger_override_name").click(function(){var nameValue=$(this).prev().val();postGenericStatus("override_name",nameValue);if(nameValue){injectFloatingMsg(jchat_override_name_saved,nameValue)}else{injectFloatingMsg(jchat_override_name_deleted,null)}});$("#jchat_trigger_skypesave").click(function(){var skypeIdValue=$(this).prev().val();postGenericStatus("skypeid",skypeIdValue);if(skypeIdValue){injectFloatingMsg(jchat_skypeidsaved,skypeIdValue)}else{injectFloatingMsg(jchat_skypeid_deleted,null)}});$("#jchat_trigger_skypedelete").click(function(){$(this).prevAll("input").val(null);postGenericStatus("skypeid",null);injectFloatingMsg(jchat_skypeid_deleted,null)});$(document).on("mouseover","#jchat_optionsbutton, #jchat_closesidebarbutton",function(){hoverSidebarTooltips(this,eval($(this).attr("id")))});$(document).on("mouseover","#jchat_maximizebutton",function(){var appendedStateClass=$(this).hasClass("maximized")?"_maximized":"_minimized";hoverSidebarTooltips(this,eval($(this).data("translation")+appendedStateClass))});$(document).on("mouseout","#jchat_optionsbutton, #jchat_closesidebarbutton, #jchat_maximizebutton",function(){$(this).removeClass("jchat_tabmouseover");$("#jchat_tooltip").css("display","none")});$(document).on("click","#jchat_optionsbutton",function(event){if(r==0){if(o==1){o=0;$("#jchat_userstab_text").html(chatTitle);ajaxReceive();$("#jchat_optionsbutton_popup .available").click()}$("#jchat_optionsbutton_popup").toggleClass("jchat_tabopen")}event.stopPropagation();return false});$(document).on("click","#jchat_maximizebutton",function(jqEvent){if(r==0){if(o==1){o=0;$("#jchat_userstab_text").html(chatTitle);ajaxReceive();$("#jchat_optionsbutton_popup .available").click()}$(this).toggleClass("maximized");$("#jchat_userstab_popup").toggleClass("maximized");$("#jchat_userstab_popup div.jchat_tabcontent.userslist").toggleClass("maximized");$("#jchat_userstab").toggleClass("maximized");$("#jchat_wall_popup").toggleClass("hidden")}jqEvent.stopPropagation();return false});$("#jchat_optionsbutton_popup .jchat_userstabtitle").click(function(){$("#jchat_optionsbutton_popup").toggleClass("jchat_tabopen")});$("#jchat_optionsbutton_popup .jchat_userstabtitle").mouseenter(function(){$(this).addClass("jchat_chatboxtabtitlemouseover2")});$("#jchat_optionsbutton_popup .jchat_userstabtitle").mouseleave(function(){$(this).removeClass("jchat_chatboxtabtitlemouseover2")});$("#jchat_avatar").toggle(function(event){avatarUploadTooltip(this)},function(event){$("#jchat_avatar").prev().remove()});jQuery("div.jchat_sounds").bind("click",function(event){audio=audio==1?0:1;restartUpdateSession("audio",audio);$(this).toggleClass("noaudio")})}function initializeWall(){$("<div/>").attr("id","jchat_wall_popup").addClass("jchat_tabpopup jchat_walltab_popup").css("display","none").html('<div class="jchat_userstabtitle">'+jchat_wall_msgs+'</div><div class="jchat_tabcontent messagelist"><div class="jchat_tabcontenttext jchat_tabcontenttext_wall"></div><div class="jchat_tabcontentinput">'+writeElementWall+'</div><div class="jchat_trigger_emoticon"></div><div class="jchat_trigger_room"></div><div class="jchat_trigger_users_informations"></div><div class="jchat_trigger_export"></div><div class="jchat_trigger_refresh"></div><div class="jchat_trigger_delete"></div><div class="jchat_trigger_history_wall"></div></div>').appendTo($(jchatTargetElement));$("#jchat_wall_popup div.jchat_userstabtitle").append('<span id="jchat_maximize_wall" data-translation="jchat_maximizebutton" class="jchat_maximizeimages"></span>');$("#jchat_maximize_wall").toggle(function(jqEvent){$("#jchat_wall_popup").addClass("maximized");var windowHeight=window.innerHeight?window.innerHeight:$(window).height();$("div.jchat_tabcontenttext_wall").height(windowHeight-103);$("#jchat_wall_popup").addClass("maximized");$(this).addClass("maximized");popupsReposition(true);$("#jchat_wall_popup .jchat_userstabtitle").off("click");jqEvent.stopPropagation();return false},function(jqEvent){$("#jchat_wall_popup").removeClass("maximized");var parentDivHeight=$("div.jchat_tabcontenttext_wall").parents("#jchat_wall_popup").height();$("div.jchat_tabcontenttext_wall").height(parentDivHeight-103);$("#jchat_wall_popup").removeClass("maximized");$(this).removeClass("maximized");popupsReposition();$("#jchat_wall_popup .jchat_userstabtitle").on("click",minimizeAllWallContents);jqEvent.stopPropagation();return false});$(".jchat_trigger_emoticon","#jchat_wall_popup").toggle(function(event){if(!!$(".jchat_roomstooltip","#jchat_wall_popup").length){$(".jchat_trigger_room","#jchat_wall_popup").click()}emoticonsTooltip(this,"#jchat_wall_popup",null,true);$(this).addClass("toggle_on")},function(event){$(".jchat_emoticonstooltip","#jchat_wall_popup").remove();$(this).removeClass("toggle_on")});$(".jchat_trigger_room","#jchat_wall_popup").toggle(function(event){if(!!$(".jchat_emoticonstooltip","#jchat_wall_popup").length){$(".jchat_trigger_emoticon","#jchat_wall_popup").click()}roomsTooltip(this,"#jchat_wall_popup",true);$(this).addClass("toggle_on")},function(event){$(".jchat_roomstooltip","#jchat_wall_popup").remove();$(this).removeClass("toggle_on")});$("#jchat_wall_popup div.jchat_trigger_refresh").click(function(event){return fetchWallMessages(0)});$("#jchat_wall_popup div.jchat_trigger_history_wall").click(function(event){return fetchWallMessages(1)});$("#jchat_wall_popup div.jchat_trigger_users_informations").mouseover(function(){wallTooltipUsers("div.jchat_trigger_users_informations");$(this).addClass("jchat_tabmouseover")});$("#jchat_wall_popup div.jchat_trigger_users_informations").mouseout(function(){$(this).removeClass("jchat_tabmouseover");$("#jchat_users_informations_tooltip").css("display","none")});$("#jchat_wall_popup div.jchat_trigger_refresh").mousedown(function(){$(this).addClass("jchat_refresh_mousedown")}).mouseup(function(){$(this).removeClass("jchat_refresh_mousedown")});$("#jchat_wall_popup div.jchat_trigger_export").append("<a/>");$("#jchat_wall_popup div.jchat_trigger_export a").attr("href",htmlLiveSite+"&task=export.display&chatid=wall");$("#jchat_wall_popup div.jchat_trigger_delete").bind("click",function(){deleteConversation("wall",true)});$("#jchat_wall_popup .jchat_textarea").keydown(function(event){return sendWallMessage(event,this)});$("#jchat_wall_popup .jchat_textarea").keyup(function(af){return popupWall(af,this,wallStartHeight)});$("#jchat_wall_popup .jchat_userstabtitle").mouseenter(function(){$(this).addClass("jchat_chatboxtabtitlemouseover2")});$("#jchat_wall_popup .jchat_userstabtitle").mouseleave(function(){$(this).removeClass("jchat_chatboxtabtitlemouseover2")});publicChatStateClosed=$.jStorage.get("publicChatStateClosed",false);var minimizeAllWallContents=function(jqEvent){$("#jchat_maximize_wall").toggle();$(this).nextAll().toggle();var invertStatus=!($.jStorage.get("publicChatStateClosed",false));$.jStorage.set("publicChatStateClosed",invertStatus);publicChatStateClosed=invertStatus;$(this).parent().toggleClass("jchat_wall_minimized");popupsReposition()};$("#jchat_wall_popup .jchat_userstabtitle").on("click",minimizeAllWallContents);if(publicChatStateClosed===true){$("#jchat_wall_popup .jchat_userstabtitle").nextAll().toggle().parent().toggleClass("jchat_wall_minimized");$("#jchat_maximize_wall").hide()}$("#jchat_wall_popup .jchat_userstabsubtitle").width($("#jchat_wall_popup").width()-7)}function popupsReposition(maximized,onlyElement){if(renderingMode=="auto"){$("#jchat_base").css("width","100%")}$("#jchat_userstab_popup").css("right",0).css("bottom","0");var parentDivHeight=$("div.jchat_tabcontenttext_wall").parents("#jchat_wall_popup").show().height();$("div.jchat_tabcontenttext_wall").parents("#jchat_wall_popup").hide();$("div.jchat_tabcontenttext_wall").height(parentDivHeight-103);var windowSize=$(window).width();wallStartHeight=parseInt($("#jchat_wall_popup div.jchat_tabcontenttext").height());$(".jchat_fileuploadtooltip",onlyElement).each(function(index,elem){var uploadContext=$(elem).next(".jchat_trigger_fileupload");var leftKonstant=282;if(maximized===true){leftKonstant=0}var topKonstant=60;$(elem,uploadContext).css("left",$(uploadContext).offset().left-$(window).scrollLeft()-leftKonstant).css("top",$(uploadContext).offset().top-$(window).scrollTop()-topKonstant)});$(".jchat_emoticonstooltip",onlyElement).each(function(index,elem){var emoticonsContext=$(elem).next(".jchat_trigger_emoticon");var leftKonstant=196;if(maximized===true){leftKonstant=0}var topKonstant=131;$(elem,emoticonsContext).css("left",$(emoticonsContext).offset().left-$(window).scrollLeft()-leftKonstant).css("top",$(emoticonsContext).offset().top-$(window).scrollTop()-topKonstant)});$(".jchat_roomstooltip").each(function(index,elem){var ab=$(".jchat_trigger_room").offset();var leftKonstant=382;if(maximized===true){leftKonstant=0}var windowScroll=jchatGetPageScroll();$(elem).css("left",ab.left-$(window).scrollLeft()-leftKonstant).css("top",ab.top-parseInt(windowScroll[1])-232)});$(".jchat_avatar_upload_tooltip").each(function(index,elem){var ab=$("#jchat_avatar").offset();var windowScroll=jchatGetPageScroll();$(elem).css("left",ab.left-$(window).scrollLeft()-45).css("top",ab.top-parseInt(windowScroll[1])-150)});$(".jchat_infoguesttooltip").each(function(index,elem){var uploadContext=$(elem).next(".jchat_trigger_infoguest");var leftKonstant=232;var topKonstant=201;if(maximized===true){leftKonstant=0}$(elem,uploadContext).css("left",$(uploadContext).offset().left-$(window).scrollLeft()-leftKonstant).css("top",$(uploadContext).offset().top-$(window).scrollTop()-topKonstant)});$(".jchat_historytooltip").each(function(index,elem){var uploadContext=$(elem).next(".jchat_trigger_history");var leftKonstant=102;var topKonstant=161;$(elem,uploadContext).css("left",$(uploadContext).offset().left-$(window).scrollLeft()-leftKonstant).css("top",$(uploadContext).offset().top-$(window).scrollTop()-topKonstant)})}function b(Y,Z){t[Y]=Z}function e(Y){if(t[Y]){return t[Y]}else{return""}}function restartUpdateSession(Y,Z){s[Y]=Z;if(e("initialize")!=1&&e("updatesession")!=1){R=1;clearTimeout(U);U=setTimeout(function(){ajaxReceive()},restartInterval)}}function getSessionProperty(Y,Z){if(s[Y]){return s[Y]}else{return""}}function showDebugMsgs(message){if(debugEnabled){alert(message)}}function ajaxReceive(){for(vars in s){t["sessionvars["+vars+"]"]=s[vars]}t.task="stream.display";t.searchfilter=$("#jchat_users_search").val();t.force_refresh=forceBuddylistRefresh;if(R==1){b("updatesession","1");R=0}t.last_received_msg_id=n;var Y="";var wallMsgs="";$.ajax({url:jsonLiveSite,data:t,type:"post",cache:false,dataType:"json",success:function(mixed){$(".jchat_chatboxmessage.dummy_typing").remove();if(mixed){var Z=0;$.each(mixed,function(ab,ac){if(ab=="paramslist"){X=ac.chatrefresh*1000;K=ac.chatrefresh*1000;avatarUploadEnabled=!!parseInt(ac.avatarupload);avatarEnabled=!!parseInt(ac.avatarenable);attachmentsEnabled=!!parseInt(ac.attachmentsenable);chatboxesOpenMode=!!parseInt(ac.chatboxes_open_mode);skypeEnabled=!!parseInt(ac.skypebridge);groupChat=parseInt(ac.groupchat);privateChatEnabled=!!parseInt(ac.privatechat_enabled);typingEnabled=!!parseInt(ac.typing_enabled);buddyListVisible=!!parseInt(ac.buddylist_visible);groupChatMode=ac.groupchatmode;debugEnabled=!!parseInt(ac.enable_debug);resizableChatboxes=!!parseInt(ac.resizable_chatboxes);autoClosePopups=!!parseInt(ac.auto_close_popups);resizableSidebar=!!parseInt(ac.resizable_sidebar);searchFieldEnabled=!!parseInt(ac.searchfield);showChatroomsUsersDetails=!!parseInt(ac.chatrooms_users_details);chatRoomLatestMessages=!!parseInt(ac.chatrooms_latest);autoClearConversation=!!parseInt(ac.autoclear_conversation);usersBanning=!!parseInt(ac.usersbanning);wordsBanning=!!parseInt(ac.wordsbanning);wordsBanned=ac.wordsbanned;wordsBannedReplacement=ac.wordsbanned_replacement;messagesHistory=!!parseInt(ac.history);maximizeButton=parseInt(ac.maximize_box);renderingMode=ac.rendering_mode;guestEnabledMode=ac.guestenabled;chatTitle=ac.chat_title;excludeOnMobile=parseInt(ac.exclude_onmobile);asyncSendMessage=ac.async_send_message;if(!!parseInt(ac.offline_message_switcher)){jchat_nousers='<div class="jchat_nousers_placeholder">'+ac.offline_message+"</div>"}if(renderingMode!="auto"){targetElement="jchat_target"}isGuest=!!parseInt(ac.isguest);allowGuestAvatarupload=!!parseInt(ac.allow_guest_avatarupload);allowGuestFileupload=!!parseInt(ac.allow_guest_fileupload);allowGuestSkypeBridge=!!parseInt(ac.allow_guest_skypebridge);allowGuestOverrideName=!!parseInt(ac.allow_guest_overridename);allowGuestBanning=!!parseInt(ac.allow_guest_banning);allowMediaObjects=!!parseInt(ac.allow_media_objects);var sidebarWidth=parseInt(ac.sidebar_width);var calculatedRatio=Math.abs(parseInt((260-sidebarWidth)/10));if(sidebarWidth<260){calculatedRatio+=2;calculatedRatio=-calculatedRatio;buddyLength+=calculatedRatio}if(renderingMode=="module"&&ac.baloon_position=="bottom"){$("#jchat_base").detach().appendTo(jchatTargetElement)}}if(ab=="buddylist"){if(!ac){$(".jchat_nousers, .jchat_userlist").remove();if($("#jchat_users_search:focus").length){$(".jchat_userscontent").append('<div class="jchat_nousers">'+jchat_nousers_filter+"</div>")}else{$(".jchat_userscontent").append('<div class="jchat_nousers">'+jchat_nousers+"</div>")}$("#jchat_userstab_text").html(chatTitle+"(0)");buddyList={};$("span[id^=jchat_user_] div.jchat_closebox_bottom_status").removeClass("jchat_available").addClass("jchat_disconnected").html("")}else{buddyList=ac;$(".jchat_nousers").remove();var numUsers=0;$.each(ac,function(ae,ad){listaUtenti(ad.id,ad.name,ad.status,ad.message,ad,false);if(ad.status!=="offline"){numUsers++}});$("#jchat_userstab_text").html(chatTitle+"("+numUsers+")");var presentUsers=$("div.jchat_userlist");$.each(presentUsers,function(k,HTMLelem){var thisUserId=$(HTMLelem).data("id");if($.inArray(thisUserId,mixed.buddylist_ids)==-1){$(HTMLelem).remove();$("#jchat_user_"+thisUserId+" div.jchat_closebox_bottom_status").removeClass("jchat_available").addClass("jchat_disconnected").html("")}})}}if(ab=="my_username"&&ab!=""&&ab!="undefined"){if(ac.length>chatLength){my_username=ac.substr(0,chatLength)+"..."}else{my_username=ac}$("#jchat_myusername").html(jchat_me+"<span>"+my_username+"</span>")}if(ab=="my_avatar"&&ab!=""&&ab!==undefined&&ab!==null){my_avatar=ac}if(ab=="loggedout"){$("#jchat_optionsbutton").addClass("jchat_optionsimages_exclamation");$("#jchat_userstab").hide();$("#jchat_optionsbutton_popup").hide();$("#jchat_wall_popup").hide();$("#jchat_userstab_popup").hide();$(".jchat_tabopen").css("cssText","display: none !important;");if(T!=""){$("#jchat_user_"+T+"_popup").hide();T=""}r=1}if(ab=="userstatus"){$.each(ac,function(ad,ae){if(ad=="message"){$("#jchat_optionsbutton_popup .jchat_statustextarea").val(ae)}if(ad=="status"){if(ae=="offline"){usersTabSt(1)}else{statusClassOp();$("#jchat_userstab_icon").addClass("jchat_user_"+ae+"2");$("#jchat_optionsbutton_popup ."+ae).css("text-decoration","underline")}}if(ad=="override_name"){$("#override_name").val(ae)}if(ad=="skype_id"){$("#skype_id").val(ae)}if(ad=="room_id"){currentJoinedChatRoom=ae}})}if(ab=="typing_status"){var typingStatus=ac;if(typingStatus){$.each(typingStatus,function(index,object){var targetChatboxPopup=$("#jchat_user_"+index+"_popup");var targetChatboxPopupText=$("div.jchat_tabcontenttext",targetChatboxPopup);if(targetChatboxPopup.length){var elementToAppend=null;var userAvatar=$("span.jchat_userscontentname img","#jchat_userlist_"+index);if(userAvatar.length){elementToAppend=userAvatar.get(0).outerHTML}else{elementToAppend="<strong>"+$("span.jchat_userscontentname","#jchat_userlist_"+index).text()+"</strong>"}var dummyTypingSnippet='<div class="jchat_chatboxmessage dummy_typing"><span class="jchat_chatboxmessagefrom">'+elementToAppend+'</span><span class="jchat_chatboxmessagecontent">...</span></div>';targetChatboxPopupText.append(dummyTypingSnippet).scrollTop(targetChatboxPopupText.get(0).scrollHeight)}})}}if(ab=="lastreadmessages"){var lastReadMessages=ac;$.each(lastReadMessages,function(chatBoxID,msgID){if($("#jchat_user_"+chatBoxID+"_popup").length){var lastMsg=$("div.jchat_tabcontenttext.private div.jchat_chatboxmessage.selfmessage:last-child","#jchat_user_"+chatBoxID+"_popup");var lastMsgID=lastMsg.attr("id");var nextAdvice=$("#jchat_message_"+msgID).next("span.msg_seen");if(lastMsgID==="jchat_message_"+msgID&&!nextAdvice.length){$("#jchat_message_"+msgID).after('<span class="msg_seen">'+jchat_seen+"</span>");var thisTabContextText=$("#jchat_user_"+chatBoxID+"_popup .jchat_tabcontenttext");var toScrollValue=$(thisTabContextText)[0].scrollHeight;$(thisTabContextText).animate({scrollTop:toScrollValue},800,"swing")}}})}if(ab=="chatrooms"){roomsAvailable=ac;if(!currentJoinedChatRoom&&firstCall){currentJoinedChatRoom=mixed.userstatus["room_id"]}$.each(roomsAvailable,function(k,room){var isMyJoinedRoom=!!(room.id==currentJoinedChatRoom);if(currentJoinedChatRoom&&isMyJoinedRoom&&!publicChatStateClosed){room.name=room.name.length<chatRoomLength?room.name:room.name.substr(0,chatRoomLength)+"...";var subTitle=$("<div/>").addClass("jchat_userstabsubtitle").html('<span class="jchat_roomtitle">'+jchat_chatroom+"</span> "+room.name);$(".jchat_userstabtitle","#jchat_wall_popup").next(".jchat_userstabsubtitle").remove().end().after(subTitle);$("#jchat_wall_popup .jchat_userstabsubtitle").width($("#jchat_wall_popup").width()-7);room.numusers++}addChatRoomsUsersDetails(room,isMyJoinedRoom);$(".jchat_roomcount[data-roomcountid="+room.id+"]").text(jchat_chatroom_users+room.numusers)})}if(ab=="users_inmyroom"){myChatRoomUsers=ac}if(ab=="initialize"){firstCall=true;$.each(ac,function(ad,af){if(ad=="buddylist"){if(af==1){$("#jchat_userstab").click()}}if(ad=="options"){if(af==1){$("#jchat_optionsbutton").click()}}if(ad=="activeChatboxes"){if(!!parseInt(ac.buddylist)||chatboxesOpenMode){var ag=af.split(/,/);for(var i=0;i<ag.length;i++){var ae=ag[i].split(/\|/);$("#jchat_userlist_"+ae[0]).dblclick();if(parseInt(ae[1])>0){tabAlert(ae[0],ae[1],0,{})}}}}if(ad=="audio"){audio=af;if(audio==0){$("div.jchat_sounds").addClass("noaudio")}}});b("initialize","0")}if(ab=="wallmessages"){$.each(ac,function(af,ad){++Z;var selfClass="";if(ad.self==1){if(my_avatar!==undefined&&my_avatar!==null&&my_avatar!==""&&avatarEnabled===true){fromPlaceholder='<img alt="'+jchat_you+my_username+'" data-time="'+ad.time+'" width="32px" height="32px" src="'+my_avatar+'" />'}else{fromPlaceholder="<strong>"+my_username+"</strong>"}selfClass=" selfmessage"}else{var userName=$("#jchat_userlist_"+ad.fromuserid).triggerHandler("getname");var userAvatar=$("#jchat_userlist_"+ad.fromuserid).triggerHandler("getavatar");if(userAvatar===undefined||userAvatar===null||userAvatar===""){userAvatar=ad.avatar}if(userName===undefined||userName===null||userName===""){if(ad.fromuser.length>chatLength){userName=ad.fromuser.substr(0,chatLength)+"..."}else{userName=ad.fromuser}}if(userAvatar!==undefined&&userAvatar!==null&&userAvatar!==""&&!userAvatar.match(/default_other.png/)&&avatarEnabled===true){fromPlaceholder='<img alt="'+userName+'" data-time="'+ad.time+'" width="32px" height="32px" src="'+userAvatar+'" />'}else{fromPlaceholder="<strong>"+userName+"</strong>"}if(typeof ad.profilelink!=="undefined"&&ad.profilelink!==""&&ad.profilelink!==null){fromPlaceholder='<a href="'+ad.profilelink+'" target="_blank">'+fromPlaceholder+"</a>"}}ad.message=strip_tags(ad.message,allowMediaObjects);ad.message=ad.message.replace(/&/gi,"&amp;");if($("#jchat_message_"+ad.id).length>0){}else{wallMsgs+=('<div class="jchat_chatboxmessage'+selfClass+'" id="jchat_message_'+ad.id+'"><span class="jchat_chatboxmessagefrom">'+fromPlaceholder+'</span><span class="jchat_chatboxmessagecontent'+selfClass+'">'+ad.message+"</span></div>");if(audio==1&&firstCall===false){msgNotify.playWallMessageAlert()}}})}if(ab=="messages"){var mutexMaximized=function(from){var validMaximized=false;$("div[id^=jchat_user_]").each(function(index,elem){var thisID=$(elem).attr("id");var hasMaximizedClass=$(elem).hasClass("maximized");if(hasMaximizedClass&&thisID!="jchat_user_"+from+"_popup"){validMaximized=true}$(elem).removeClass("maximized_hover")});if(validMaximized){$("#jchat_user_"+from+"_popup").addClass("maximized_hover")}};$.each(ac,function(af,ad){n=ad.id;var selfClass="";$("span.msg_seen","#jchat_user_"+(ad.from)+"_popup").remove();if($("#jchat_user_"+(ad.from)+"_popup").length>0){if(ad.self==1){if(my_avatar!==undefined&&my_avatar!==null&&my_avatar!==""&&avatarEnabled===true){fromPlaceholder='<img alt="'+jchat_you+my_username+'" data-time="'+ad.time+'" width="32px" height="32px" src="'+my_avatar+'" />'}else{fromPlaceholder="<strong>"+my_username+"</strong>"}selfClass=" selfmessage"}else{var userName=$("#jchat_userlist_"+ad.from).triggerHandler("getname");var userAvatar=$("#jchat_userlist_"+ad.from).triggerHandler("getavatar");if(userAvatar===undefined||userAvatar===null||userAvatar===""){userAvatar=ad.avatar}if(userName===undefined||userName===null||userName===""){userName=ad.fromuser}if(userAvatar!==undefined&&userAvatar!==null&&userAvatar!==""&&avatarEnabled===true){fromPlaceholder='<img alt="'+userName+'" data-time="'+ad.time+'" width="32px" height="32px" src="'+userAvatar+'" />'}else{fromPlaceholder="<strong>"+userName+"</strong>"}if(typeof ad.profilelink!=="undefined"&&ad.profilelink!==""&&ad.profilelink!==null){fromPlaceholder='<a href="'+ad.profilelink+'" target="_blank">'+fromPlaceholder+"</a>"}}if(ad.type=="file"){if(firstCall){var sound=false}ad.message=trasformMsgFile(ad.message,ad.id,ad.self,ad.from,ad.status,sound)}else{ad.message=strip_tags(ad.message,allowMediaObjects);ad.message=ad.message.replace(/&/gi,"&amp;")}if($("#jchat_message_"+ad.id).length>0){}else{Y=('<div class="jchat_chatboxmessage'+selfClass+'" id="jchat_message_'+ad.id+'"><span class="jchat_chatboxmessagefrom">'+fromPlaceholder+'</span><span class="jchat_chatboxmessagecontent'+selfClass+'">'+ad.message+"</span></div>");if(audio==1&&firstCall===false&&ad.type!="file"){msgNotify.playMessageAlert()}if(!ad.old){var target=$("#jchat_user_"+ad.from+"_popup .jchat_textarea");if(target.length&&!$(target).is(":focus")&&!$(target).data("isblinking")){$(target).blink();$(target).data("isblinking",true)}}}$("#jchat_user_"+ad.from+"_popup .jchat_tabcontenttext").append(Y);$("#jchat_user_"+ad.from+"_popup .jchat_tabcontenttext").scrollTop($("#jchat_user_"+ad.from+"_popup .jchat_tabcontenttext")[0].scrollHeight);$("span.jchat_chatboxmessagefrom img").mouseover(function(event){avatarTooltip(this,$(this).attr("alt"),$(this).data("time"))}).mouseout(function(event){$("#jchat_avatartooltip").remove()});if(!isTabFocused&&ad.self!=1){$("title").text(userName+jchat_newmessage_tab)}mutexMaximized(ad.from)}else{var lastMessageReached=!!(af==(ac.length-1));$("#jchat_userlist_"+ad.from).trigger("addmessage",[ad.message,ad.self,ad.old,ad.id,ad,lastMessageReached]);mutexMaximized(ad.from)}});h=1;K=X}if(ab=="downloads"){$.each(ac,function(k,elem){refreshMsgFileStatus(elem[0],elem[1])})}});if(wallMsgs){$("#jchat_wall_popup div.jchat_tabcontenttext").append(wallMsgs);$("#jchat_wall_popup div.jchat_tabcontenttext").scrollTop($("#jchat_wall_popup div.jchat_tabcontenttext")[0].scrollHeight);$("span.jchat_chatboxmessagefrom img","#jchat_wall_popup").mouseover(function(event){avatarTooltip(this,$(this).attr("alt"),$(this).data("time"))}).mouseout(function(event){$("#jchat_avatartooltip").remove()});if(!$("#jchat_userstab").hasClass("jchat_tabclick")&&!$("#jchat_newpublic_msg").length&&!firstCall){$("<span/>").attr("id","jchat_newpublic_msg").addClass("jchat_tab").appendTo($("#jchat_userstab"));var alertElem=$("#jchat_newpublic_msg");wallMessagesAlertInterval=setInterval(function(){if(alertElem.data("blink")){$(alertElem).toggleClass("hidden").data("blink",false)}else{$(alertElem).toggleClass("hidden").data("blink",true)}},600)}}}b("initialize","0");b("updatesession","0");if(r!=1&&o!=1){h++;if(h>emptyResponse){K*=2;h=1}if(K>F){K=F}clearTimeout(U);U=setTimeout(function(){ajaxReceive()},K)}if(firstCall&&groupChat){popupsReposition();if($("#jchat_wall_popup div.jchat_tabcontenttext").length){$("#jchat_wall_popup div.jchat_tabcontenttext").scrollTop($("#jchat_wall_popup div.jchat_tabcontenttext").get(0).scrollHeight)}}firstCall=false;sound=true;if(!groupChat||(groupChat>1&&jchatDetectMobileDevice(groupChat))){$("#jchat_wall_popup").remove();$("span.jchat_contact").hide()}if(!buddyListVisible){$("#jchat_userstab_popup").removeClass("jchat_tabopen").hide();if(renderingMode=="auto"){$("#jchat_wall_popup").css({bottom:"27px",top:"inherit"})}}if(groupChatMode!="invite"){$("span.jchat_contact").hide()}if(!usersBanning||(isGuest&&!allowGuestBanning)){$("span.jchat_banning").hide()}if(groupChatMode!="chatroom"){$("div.jchat_trigger_room").hide()}if(!searchFieldEnabled){$("#jchat_users_search").hide()}if(!messagesHistory){$("div.jchat_trigger_history_wall").hide()}if(!maximizeButton||(maximizeButton>1&&!jchatDetectMobileDevice(maximizeButton))){$("#jchat_maximizebutton").remove();$("#jchat_maximize_wall").remove()}if(window.sessionStorage){if(isGuest&&guestEnabledMode==2&&!sessionStorage.getItem("jchat_joined")){clearTimeout(U);$("#jchat_base").hide();$("#jchat_wall_popup, #jchat_userstab_popup").removeClass("jchat_tabopen")}}}})}function trasformMsgFile(msgText,idMessage,self,from,status,sounds){var attachmentStringImg='<img class="clessidra" src="'+jchat_livesite+'components/com_jchat/images/attachment.png"/>';if(sounds!==false){msgNotify.playSentFile()}if(self==1){msgText=attachmentStringImg+jchat_sent_file+'<div class="filename">'+msgText+"</div>";if(status==0){msgText+='<img class="clessidra" src="'+jchat_livesite+'components/com_jchat/images/default/loading.gif"/>'+jchat_sent_file_waiting}else{msgText+=jchat_sent_file_downloaded}}else{var href="index.php?option=com_jchat&amp;task=attachments.showEntity&amp;format=raw&amp;idMessage="+idMessage+"&amp;from="+from;var link='<a class="msgfile" href="'+href+'">'+jchat_sent_file_download+"</a>";msgText=attachmentStringImg+jchat_received_file+'<div class="filename">'+msgText+"</div>"+link}return msgText}function makeSidebarResizable(){if(!resizableSidebar||renderingMode=="module"){return false}$("#jchat_userstab_popup").resizable({handles:"w",minWidth:260,maxWidth:450,alsoResize:"#jchat_userstab, #jchat_wall_popup",resize:function(event,ui){$(ui.element).css("left","auto");$("#jchat_wall_popup .jchat_userstabsubtitle").width($(ui.element).width()-7)},stop:function(event,ui){$.jStorage.set("sidebarWidth",ui.size.width)}});$("#jchat_wall_popup").resizable({handles:"w",minWidth:260,maxWidth:400,alsoResize:"#jchat_userstab, #jchat_userstab_popup",resize:function(event,ui){$(ui.element).css("left","auto");$("#jchat_wall_popup .jchat_userstabsubtitle").width($(ui.element).width()-7);popupsReposition()},stop:function(event,ui){$.jStorage.set("sidebarWidth",ui.size.width)}})}function refreshMsgFileStatus(idPopupUser,idMessage){$("#jchat_message_"+idMessage+" span.jchat_chatboxmessagecontent span.filestatus","#jchat_user_"+idPopupUser+"_popup").prev().remove();$("#jchat_message_"+idMessage+" span.jchat_chatboxmessagecontent span.filestatus","#jchat_user_"+idPopupUser+"_popup").html(jchat_sent_file_downloaded_realtime);msgNotify.playCompleteFile()}function injectSkypeControls(userObject){if(!userObject.skypeid||!skypeEnabled){return false}var appendDomElems=function(){if(skypeInstalled){var domElems='<div class="jchat_skypecall"><a data-text="'+jchat_startskypecall+'" class="skypeicon" href="skype:'+userObject.skypeid+'?call"></a></div>'}else{var domElems='<div class="jchat_skypecall disabled"><a class="skypeicon" data-text="'+jchat_startskypedownload+'" href="http://www.skype.com/intl/en/get-skype/" target="_blank"></a></div>'}$("#jchat_userlist_"+userObject.id).append(domElems);$("#jchat_userlist_"+userObject.id+" div.jchat_skypecall a").on("click",function(event){event.stopPropagation()}).on("mouseover",function(event){triggerGenericPopover("#jchat_skypecall",this)}).on("mouseout",function(event){$("#jchat_skypecall").css("display","none").remove()})};var skypeInstalled=true;appendDomElems();$("div.jchat_skypecall a").click(function(event){event.preventDefault();var startcallTimeout=200;if(jchatHasTouch()){startcallTimeout=1500}setTimeout(function(){$(event.target).trigger("mouseout");window.location=$(event.target).attr("href")},startcallTimeout)});return skypeInstalled}function updateGroupChatUsers(op,value){var postVars={task:op,id:value};$.ajax({url:jsonLiveSite,data:postVars,type:"post",cache:false,dataType:"json",success:function(response){if(!response.storing.status){showDebugMsgs(response.storing.details)}}})}(function startApp(){if(jchat_excludeonmobile&&jchatDetectMobileDevice(jchat_excludeonmobile)){return false}initializeOptionsDiv();isContentEditable=supportContentEditable();if(!isContentEditable){writeElement='<textarea class="jchat_textarea" ></textarea>';writeElementWall='<textarea class="jchat_textarea jchat_textarea_wall"></textarea>';valFunction="val"}initializeWall();initializeDom();$(window).on("resize scroll",popupsReposition);b("buddylist","1");b("initialize","1");-b("updatesession","0");$([window,document]).blur(function(){J=false}).focus(function(){if(J==false){l=1}J=true});if($.jStorage.get("popupPositions",false)){popupPositions=$.jStorage.get("popupPositions")}if($.jStorage.get("popupDimensions",false)){popupDimensions=$.jStorage.get("popupDimensions")}if($.jStorage.get("popupState",false)){popupState=$.jStorage.get("popupState")}if($.jStorage.get("sidebarWidth",false)){var overridenSidebarWidth=parseInt($.jStorage.get("sidebarWidth"));if(overridenSidebarWidth!=260){$("#jchat_wall_popup, #jchat_userstab_popup").width(overridenSidebarWidth);$("#jchat_userstab").width(overridenSidebarWidth-2)}}ajaxReceive()})();return function activateStream(){ajaxReceive()}}jQuery(function(a){window.jchatApplicationStreamActivate=a.jchat(a);msgNotify=new jchatSounds();var b=false;if(jchatHasTouch()){a(document).on("touchstart","body",function(c){if(!b){msgNotify.initPlayEmptySound();b=true}a(".jchat_generic_tooltip, #jchat_users_informations_tooltip, #jchat_tooltip, #jchat_avatartooltip").hide()})}});